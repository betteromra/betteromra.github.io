<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Omra Portfolio</title>
  <link href="Images/favicon.ico" rel="icon" type="image/x-icon">
  <link href="style.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
</head>

<body>

  <div class="hero">
    <div class="hero-content">
      <div class="hero-container">
        <p class="hero-text">Hello! I'm Omra, <b>gameplay programmer</b> driven by curiosity, collaboration and the joy
          of
          bringing games to life</p>
        <a href="mailto:omra@betteromra.com" class="email-button">
          Contact Me
        </a>
      </div>
      <img class="hero-signature" src="Images/Signature.png">
    </div>

    <div class="background-video">
      <iframe
        src="https://www.youtube.com/embed/xerVvQ2-Uc4?autoplay=1&mute=1&loop=1&controls=0&modestbranding=1&rel=0&playlist=xerVvQ2-Uc4"
        frameborder="0" allow="autoplay; fullscreen" title="Reel - Gabriel Belanger - 2025" allow="autoplay; fullscreen"
        referrerpolicy="strict-origin-when-cross-origin"></iframe>
    </div>
  </div>

  <div class="content">
    <div class="technologies"><div class="technology"><div class="image-technology" style="background-image: url('Images/Technologies/CSharp.png');"></div><p>C#</p></div><div class="technology"><div class="image-technology" style="background-image: url('Images/Technologies/CPlusPlus.png');"></div><p>C++</p></div><div class="technology"><div class="image-technology" style="background-image: url('Images/Technologies/Python.png');"></div><p>Python</p></div><div class="technology"><div class="image-technology" style="background-image: url('Images/Technologies/Java.png');"></div><p>Java</p></div><div class="technology"><div class="image-technology" style="background-image: url('Images/Technologies/JS.png');"></div><p>JS</p></div><div class="technology"><div class="image-technology" style="background-image: url('Images/Technologies/Unreal.png');"></div><p>Unreal</p></div><div class="technology"><div class="image-technology" style="background-image: url('Images/Technologies/Unity.png');"></div><p>Unity</p></div><div class="technology"><div class="image-technology" style="background-image: url('Images/Technologies/Github.png');"></div><p>Github</p></div><div class="technology"><div class="image-technology" style="background-image: url('Images/Technologies/Jira.png');"></div><p>Jira</p></div><div class="technology"><div class="image-technology" style="background-image: url('Images/Technologies/Asana.png');"></div><p>Asana</p></div><div class="technology"><div class="image-technology" style="background-image: url('Images/Technologies/Adobe.png');"></div><p>Adobe</p></div></div>
    <div class="games"><div class="game"><div class="game-thumbnail"><div class="game-technologies"><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Unreal.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/CPlusPlus.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Github.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Jira.png');"></div></div></div><div class="thumbnail-content"><i>Janurary 2025 ~ October 2025</i><h2>THE SIGNAL: Stranded on Sirenis</h2><p>A survival crafting extraction shooter game where players explore diverse environments, gather resources, build bases and strategically combat on the alien planet.</p></div><div class="image-thumbnail" style="background-image: url('Images/Thumbnails/THESIGNALStrandedonSirenis main.jpg');"></div><div class="image-thumbnail-over" style="background-image: url('Images/Thumbnails/THESIGNALStrandedonSirenis gameplay.jpg');"></div></div><div class="game-content"><div class="game-container"><div class="game-content-header"><div class="game-content-header-title"><div class="game-content-header-logo"><img src="Images/Logos/THESIGNALStrandedonSirenis.png"></div><div class="game-content-header-links"><a target="_blank" class="game-link" href="https://store.steampowered.com/app/1830110/THE_SIGNAL_Stranded_on_Sirenis/" style="background-image: url('Images/Stores/Steam.png');"></a></div></div><div class="game-content-header-tag"><div class="game-genre">Survival</div><div class="game-genre">Crafting</div><div class="game-genre">Extraction shooter</div><div class="game-genre">Base building</div><div class="game-style">Science fiction</div><div class="game-style">Realistic</div><div class="game-style">Stylize</div></div><div class="game-content-header-job"><div class="game-content-header-role"><img class="job-icon" src="Images/Icons/role.svg">Gameplay Programmer</div><div class="game-content-header-team"><img class="job-icon" src="Images/Icons/team.svg">21</div><div class="game-content-header-time"><img class="job-icon" src="Images/Icons/time.svg">9 months</div></div></div><div class="game-content-main" id="THESIGNALStrandedonSirenisContent"><h3>Unreal Engine Weapon Systems and Character Upgrades</h3>
<p>
  This project was a large-scale Unreal Engine game where I was responsible for designing and implementing the weapon
  systems.
  My work included multiple core features such as reload mechanics, weapon overheating,
  critical hits, damage falloff over distance and on-hit visual and particle effects.
</p>
<p>
  This was my first experience working with Unreal Engine and I quickly became proficient with Blueprints,
  BlueprintCallable functions, C++ integration, Data Assets and
  Data Tables. I also learned to utilize Unreal's sweep-based bullet physics to implement realistic projectile
  interactions.
</p>
<p>
  I created a variety of weapons including a pistol, shotgun, assault rifle,
  submachine gun, sniper rifle and rocket launcher. Each weapon featured unique behavior and was integrated into the
  overall combat system.
  There was also a system to switch between bullet type, so it was possible to switch from incendary ammo to normal
  ammor to poison ammo,
  all working with applying effect on hit that stacked to certain ammount.
</p>
<p>
  In addition to weapon systems, I implemented a character upgrade system.
  Players could enhance their main character by adding health, armor and carry weight capacity.
  Weapon upgrades included reduced spread for shotguns, increased magazine capacity,
  higher bullet velocity and faster firing rates. These upgrades required careful balancing to ensure
  a meaningful progression system while maintaining gameplay challenge.
</p>
<p>
  Overall, this project gave me extensive experience with Unreal Engine's Blueprint system,
  C++ integration, gameplay mechanics design and creating modular, scalable systems for both weapons and player
  progression.
</p>

<pre class="language-cpp" tabindex="0"><code class="language-cpp">

</code>
</pre></div></div></div></div><div class="game"><div class="game-thumbnail"><div class="game-technologies"><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Unity.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/CSharp.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Github.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Jira.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Adobe.png');"></div></div></div><div class="thumbnail-content"><i>December 2021 ~ Present</i><h2>The Melty Way</h2><p>A puzzle-platformer where players control a shape shifting slime, navigating vibrant levels, solving puzzles, avoiding traps and using creative movement to explore hidden paths and overcome challenges.</p></div><div class="image-thumbnail" style="background-image: url('Images/Thumbnails/TheMeltyWay main.jpg');"></div><div class="image-thumbnail-over" style="background-image: url('Images/Thumbnails/TheMeltyWay gameplay.jpg');"></div></div><div class="game-content"><div class="game-container"><div class="game-content-header"><div class="game-content-header-title"><div class="game-content-header-logo"><img src="Images/Logos/TheMeltyWay.png"></div><div class="game-content-header-links"><a target="_blank" class="game-link" href="https://store.steampowered.com/app/3990570/The_Melty_Way/" style="background-image: url('Images/Stores/Steam.png');"></a></div></div><div class="game-content-header-tag"><div class="game-genre">Plateformer</div><div class="game-genre">Puzzle</div><div class="game-genre">Adventure</div><div class="game-style">Pixel Art</div><div class="game-style">Fantasy</div></div><div class="game-content-header-job"><div class="game-content-header-role"><img class="job-icon" src="Images/Icons/role.svg">Game Programmer, Artist, Game Design, Marketer</div><div class="game-content-header-team"><img class="job-icon" src="Images/Icons/team.svg">2</div><div class="game-content-header-time"><img class="job-icon" src="Images/Icons/time.svg">4 years</div></div></div><div class="game-content-main" id="TheMeltyWayContent"><p>The Melty Way is a 2D puzzle-platformer where you play as a soft body slime navigating <strong>60
    handcrafted levels</strong> filled with size based challenges, hazards, liquids and dynamic environments. The game
  blends <strong>responsive precision platforming</strong> with light puzzle solving, encouraging players to
  master movement, experiment with size shifting abilities and adapt to new obstacles.</p>

<p>You progress through <strong>themed floors of a mysterious wizard tower</strong>, each introducing new mechanics,
  from lasers and
  cannons to sticky tiles, conveyors and <strong>reactive liquids</strong> that change how your slime moves. The story
  is light,
  focusing on exploration and discovery, but the atmosphere, color system and NPC moments add charm and personality.</p>

<p>The core gameplay loop is : <strong>learn a mechanic → practice safely → master it in
    challenging rooms → advance to the next floor</strong>. It's a die and retry experience. <strong>Collectible
    dyes</strong> let players
  customize the slime and the save/load system ensures long-term progression.</p>

<p>The Melty Way is built for players who enjoy tight controls, clever level design and satisfying game
  feel, similar to
  fans of <strong>Celeste, Super Meat Boy and Super Mario Bros. Wonder</strong>. With <strong>full controller
    support</strong>, polished player feedback
  and an evolving set of mechanics, the game aims to feel fluid, expressive and rewarding to master.</p>

<ul>
  <li><a href="#Player-TheMeltyWay">Highly advanced player logic for the platformer.</a></li>
  <li><a href="#Tools-TheMeltyWay">Multiple tools to help development.</a></li>
  <li><a href="#Hazards-TheMeltyWay">Hazards to add fun and challenge.</a></li>
  <li><a href="#Liquids-TheMeltyWay">5 Liquids that are swimable with the dash ability.</a></li>
  <li><a href="#Polish-TheMeltyWay">Polish to make the game more enjoyable.</a></li>
</ul>

<h3 id="Player-TheMeltyWay">Player</h3>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Player-movement.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<ul>
  <li>Classic platformer mechanics with movement and jumping</li>
  <li>Slime dynamically changes size based on health</li>
  <li>Slime size influences max speed, acceleration, jump height and resistance</li>
  <li>Dashing ability to enhance mobility</li>
  <li>Wall jumping</li>
  <li>Soft body physics with natural jiggle during walking, running, jumping and dashing</li>
  <li>Coyote time for more forgiving jumps</li>
  <li>Jump buffering for smoother controls</li>
  <li>Input override when changing direction for more responsive movement</li>
  <li>Increased gravity when falling for better control</li>
  <li>Soft body animation</li>
  <li>Facial expressions that change based on the situation</li>
  <li>Slime size change indicator that flashes to alert the player</li>
  <li>Audio cue when the slime is low on health</li>
  <li>Pixel perfect camera pixelation with dynamic positioning while maintaining consistent pixelation</li>
  <li>Full controller support</li>
  <li>Full control remapping support</li>
  <li>Screen shake and controller rumble during key moments to enhance immersion</li>
  <li>Complete tutorial</li>
</ul>

<h4>Platforming</h4>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Platformer-polish.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Size-platforming.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<pre class="language-csharp" tabindex="0"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Actor</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>

  <span class="token punctuation">[</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">]</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Updates the internal state determining whether the actor is allowed to jump.</span>
  <span class="token comment">/// Considers ground buffer time, wall jump conditions, and sticky-object restrictions.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RefreshCanJump</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">bool</span></span> hasExitRightWall <span class="token operator">=</span> _hasExitWall<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>right <span class="token operator">||</span> _hasExitWall<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>zero<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">bool</span></span> hasExitLefttWall <span class="token operator">=</span> _hasExitWall<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>left <span class="token operator">||</span> _hasExitWall<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>zero<span class="token punctuation">;</span>

    <span class="token comment">// Can jump when:</span>
    <span class="token comment">// - Ground buffer is active (Allow ghost jump)</span>
    <span class="token comment">// - OR player is on a wall AND (wall reset is over OR wall exit direction is valid)</span>
    <span class="token comment">// - AND player is not stuck to a sticky object</span>
    _canJump <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">!</span>_timerOnGround<span class="token punctuation">.</span><span class="token function">IsOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_isOnWall <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>_wallJumpReset<span class="token punctuation">.</span><span class="token function">IsOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_leftWall <span class="token operator">&amp;&amp;</span> hasExitRightWall<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_rightWall <span class="token operator">&amp;&amp;</span> hasExitLefttWall<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> _stickyObj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Executes the beginning of a jump, including ground jumps, wall jumps,</span>
  <span class="token comment">/// movement boosts and interaction with liquids or conveyors.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">JumpStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">RefreshCanJump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_canJump<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// animate when trying to jump out sticky</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_stickyObj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> _stickyObj<span class="token punctuation">.</span><span class="token function">TryToJumpOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">JumpCancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_transport <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> _transport<span class="token punctuation">.</span>springJoint<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_isOnGround<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Wall jump</span>

      <span class="token class-name"><span class="token keyword">bool</span></span> hasExitRightWall <span class="token operator">=</span> _hasExitWall<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>right <span class="token operator">||</span> _hasExitWall<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>zero<span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">bool</span></span> hasExitLefttWall <span class="token operator">=</span> _hasExitWall<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>left <span class="token operator">||</span> _hasExitWall<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>zero<span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>_leftWall <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>hasExitRightWall <span class="token operator">||</span> _wallJumpReset<span class="token punctuation">.</span><span class="token function">IsOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// Wall jump from left wall</span>
        _hasExitWall<span class="token punctuation">.</span>vector2 <span class="token operator">=</span> Vector2<span class="token punctuation">.</span>left<span class="token punctuation">;</span>

        <span class="token comment">// Stop opposite-direction horizontal velocity before pushing off</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Mathf<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Push away from wall to facilitate wall jump</span>
        _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>_jumpOfWallForce <span class="token operator">*</span> _maxStatisticActor<span class="token punctuation">.</span>jumpHeight <span class="token operator">*</span> <span class="token number">.1f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _wallJumpReset<span class="token punctuation">.</span><span class="token function">Restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_rightWall <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>hasExitLefttWall <span class="token operator">||</span> _wallJumpReset<span class="token punctuation">.</span><span class="token function">IsOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// Wall jump from right wall</span>
        _hasExitWall<span class="token punctuation">.</span>vector2 <span class="token operator">=</span> Vector2<span class="token punctuation">.</span>right<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>Mathf<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

        _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span><span class="token operator">-</span>_jumpOfWallForce <span class="token operator">*</span> _maxStatisticActor<span class="token punctuation">.</span>jumpHeight <span class="token operator">*</span> <span class="token number">.1f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _wallJumpReset<span class="token punctuation">.</span><span class="token function">Restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Jump from ground</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>_isMoving <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>_isSlippery<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>

        <span class="token comment">// If moving in same direction as current velocity, make sure to jump at maxSpeed</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Mathf<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> Mathf<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>_moveDirection<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token class-name"><span class="token keyword">float</span></span> maxSpeed <span class="token operator">=</span> _maxStatisticActor<span class="token punctuation">.</span>maxSpeed <span class="token operator">*</span> _speedMultiplior <span class="token operator">*</span> _moveDirection<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>transport <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
          <span class="token punctuation">{</span>
            maxSpeed <span class="token operator">+=</span> _baseVelocity<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;</span> maxSpeed<span class="token punctuation">)</span> _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>maxSpeed<span class="token punctuation">,</span> _rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// if in liquid make it jump less high</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_isInLiquid<span class="token punctuation">)</span> _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x<span class="token punctuation">,</span> _maxStatisticActor<span class="token punctuation">.</span>jumpHeight <span class="token operator">*</span> <span class="token number">.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>conveyorTouching <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x<span class="token punctuation">,</span> _maxStatisticActor<span class="token punctuation">.</span>jumpHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">.5f</span> <span class="token operator">&lt;=</span> _maxStatisticActor<span class="token punctuation">.</span>jumpHeight<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// if we are on a conveyor, make sure the jump height is adjusted</span>
        _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x<span class="token punctuation">,</span> _rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">.6f</span> <span class="token operator">+</span> _maxStatisticActor<span class="token punctuation">.</span>jumpHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    _rb2D<span class="token punctuation">.</span>gravityScale <span class="token operator">=</span> _normalGravity<span class="token punctuation">;</span>

    <span class="token function">CalculateIsFalling</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">JumpVFX</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">JumpStartAddOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Optional Add on method invoked when jump starts end.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">JumpStartAddOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Performs logic while the jump input is being held.</span>
  <span class="token comment">/// Ends jump if falling.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">JumpPerform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_isFalling<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token function">JumpCancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    _rb2D<span class="token punctuation">.</span>gravityScale <span class="token operator">=</span> _normalGravity<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Cancels the jump and applies high gravity for quick fall if not in liquid.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">JumpCancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _isJumping <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_isInLiquid<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Make the gravity high when falling to have more control and precision</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>transport <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> _rb2D<span class="token punctuation">.</span>gravityScale <span class="token operator">=</span> _highGravity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Called when movement starts; triggers movement VFX if grounded.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MoveStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_isOnGround<span class="token punctuation">)</span> <span class="token function">MoveVFX</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Applies movement logic: acceleration, max speed, slopes, sticky modifiers,</span>
  <span class="token comment">/// slippery behavior, and platform velocity.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MovePerform</span><span class="token punctuation">(</span><span class="token class-name">Direction2</span> direction<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_wasOnGround <span class="token operator">&amp;&amp;</span> _isOnGround<span class="token punctuation">)</span> <span class="token function">MoveVFX</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_wasOnGround <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>_isOnGround<span class="token punctuation">)</span> <span class="token function">MoveVFX</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_wand<span class="token punctuation">.</span>isUsingSpell<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_canMoveLeft <span class="token operator">&amp;&amp;</span> direction<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_canMoveRight <span class="token operator">&amp;&amp;</span> direction<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">float</span></span> speed <span class="token operator">=</span> _rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">float</span></span> acceleration<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">float</span></span> maxSpeed<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">float</span></span> maxSpeedLeft<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">float</span></span> maxSpeedRight<span class="token punctuation">;</span>
    <span class="token class-name">Vector2</span> moveOverSlope <span class="token operator">=</span> Vector2<span class="token punctuation">.</span>zero<span class="token punctuation">;</span>

    <span class="token comment">// If walking slow, apply slope movement when standing on angled surfaces</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>Matho<span class="token punctuation">.</span><span class="token function">IsBetween</span><span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_leftGround <span class="token operator">&amp;&amp;</span> direction<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>left <span class="token operator">&amp;&amp;</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>_leftGround<span class="token punctuation">.</span>normal<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">.98f</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token class-name">Vector2</span> perpandicular <span class="token operator">=</span> Vector2<span class="token punctuation">.</span><span class="token function">Perpendicular</span><span class="token punctuation">(</span>_leftWall<span class="token punctuation">.</span>normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        moveOverSlope <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>perpandicular<span class="token punctuation">.</span>x<span class="token punctuation">,</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>perpandicular<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_rightGround <span class="token operator">&amp;&amp;</span> direction<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>right <span class="token operator">&amp;&amp;</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>_rightGround<span class="token punctuation">.</span>normal<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">.98f</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token class-name">Vector2</span> perpandicular <span class="token operator">=</span> Vector2<span class="token punctuation">.</span><span class="token function">Perpendicular</span><span class="token punctuation">(</span>_rightGround<span class="token punctuation">.</span>normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        moveOverSlope <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span><span class="token operator">-</span>perpandicular<span class="token punctuation">.</span>x<span class="token punctuation">,</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>perpandicular<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_isOnGround <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>_isInLiquid<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      maxSpeed <span class="token operator">=</span> _maxStatisticActor<span class="token punctuation">.</span>maxSpeed <span class="token operator">*</span> _speedMultiplior<span class="token punctuation">;</span>
      <span class="token comment">// Heavy reduction maxspeed when stuck</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_stickyObj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> maxSpeed <span class="token operator">*=</span> <span class="token number">.25f</span><span class="token punctuation">;</span>
      <span class="token comment">// Slippery surfaces allow high max speeds</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_isSlippery<span class="token punctuation">)</span> maxSpeed <span class="token operator">*=</span> <span class="token number">5f</span><span class="token punctuation">;</span>
      acceleration <span class="token operator">=</span> _maxStatisticActor<span class="token punctuation">.</span>acceleration <span class="token operator">*</span> _speedMultiplior<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Air movement reduced</span>
      maxSpeed <span class="token operator">=</span> _maxStatisticActor<span class="token punctuation">.</span>maxSpeed <span class="token operator">*</span> <span class="token number">.6f</span><span class="token punctuation">;</span>
      <span class="token comment">// Reduce maxspeed when stuck</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_isStickySide<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> maxSpeed <span class="token operator">*=</span> <span class="token number">.6f</span><span class="token punctuation">;</span>
      acceleration <span class="token operator">=</span> _maxStatisticActor<span class="token punctuation">.</span>acceleration <span class="token operator">*</span> <span class="token number">.3f</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    maxSpeedLeft <span class="token operator">=</span> <span class="token operator">-</span>maxSpeed<span class="token punctuation">;</span>
    maxSpeedRight <span class="token operator">=</span> maxSpeed<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>transport <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      maxSpeedLeft <span class="token operator">+=</span> _baseVelocity<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
      maxSpeedRight <span class="token operator">+=</span> _baseVelocity<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Lower acceleration on slippery surfaces</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_isSlippery<span class="token punctuation">)</span> acceleration <span class="token operator">=</span> acceleration <span class="token operator">*</span> <span class="token number">.1f</span> <span class="token operator">+</span> <span class="token number">.1f</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> maxSpeedRight <span class="token operator">&amp;&amp;</span> direction<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// Strong boost when switching directions</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_isSlippery<span class="token punctuation">)</span> acceleration <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> acceleration <span class="token operator">*=</span> <span class="token number">5</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      speed <span class="token operator">=</span> _rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x <span class="token operator">+</span> direction<span class="token punctuation">.</span>x <span class="token operator">*</span> acceleration<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x <span class="token operator">&gt;</span> maxSpeedLeft <span class="token operator">&amp;&amp;</span> direction<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// Strong boost when switching directions</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_isSlippery<span class="token punctuation">)</span> acceleration <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> acceleration <span class="token operator">*=</span> <span class="token number">5</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      speed <span class="token operator">=</span> _rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x <span class="token operator">+</span> direction<span class="token punctuation">.</span>x <span class="token operator">*</span> acceleration<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_isOnGround <span class="token operator">||</span> _isStickySide<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      speed <span class="token operator">=</span> Matho<span class="token punctuation">.</span><span class="token function">Clamp</span><span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>_maxStatisticActor<span class="token punctuation">.</span>acceleration <span class="token operator">*</span> <span class="token number">.5f</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">99f</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>_rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_stickyObj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> speed <span class="token operator">=</span> Matho<span class="token punctuation">.</span><span class="token function">Clamp</span><span class="token punctuation">(</span>speed<span class="token punctuation">,</span> maxSpeed<span class="token punctuation">,</span> <span class="token operator">-</span>maxSpeed<span class="token punctuation">)</span><span class="token punctuation">;</span>

    _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>speed<span class="token punctuation">,</span> _rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> moveOverSlope<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Stops movement and disables movement VFX.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MoveCancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">MoveVFX</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Starts sprinting by increasing speed multiplier.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SprintStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _speedMultiplior <span class="token operator">=</span> <span class="token number">2f</span><span class="token punctuation">;</span>
    <span class="token function">SprintVFX</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Stops sprinting and resets speed multiplier.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SprintCancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _speedMultiplior <span class="token operator">=</span> <span class="token number">1f</span><span class="token punctuation">;</span>
    <span class="token function">SprintVFX</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">[</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">]</span>

<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ControllableActor</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Actor</span></span>
<span class="token punctuation">{</span>
  <span class="token comment">// Tracks whether movement input was pressed (used for multiple input)</span>
  <span class="token class-name"><span class="token keyword">int</span></span> _moveInputPressed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">// Jump buffer timer allowing leniency for jump input</span>
  <span class="token class-name">Timer</span> _jumpBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Timer</span><span class="token punctuation">(</span><span class="token number">.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Used to detect direction changes when the old direction was one way but the player want to go the</span>
  <span class="token comment">// other way</span>
  <span class="token class-name">Direction2</span> _moveDirectionOld <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Direction2</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">.</span>NaN<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Whether spell casting is disabled</span>
  <span class="token keyword">protected</span> <span class="token class-name"><span class="token keyword">bool</span></span> _spellDisabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> spellDisabled
  <span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _spellDisabled<span class="token punctuation">;</span>
    <span class="token keyword">set</span>
    <span class="token punctuation">{</span>
      _spellDisabled <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>_spellDisabled<span class="token punctuation">)</span> <span class="token function">DisableSpell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token function">EnableSpell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// Stores input actions for the actor</span>
  <span class="token keyword">protected</span> <span class="token class-name">ActorInput</span> _input<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">ActorInput</span> input <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _input<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnEnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ActorInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">EnableControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnDisable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">DisableControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// On death disables control.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnDeathAddOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnDeathAddOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">DisableControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Enables all input actions for controlling the actor.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EnableControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>Jump<span class="token punctuation">.</span>performed <span class="token operator">+=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputJump</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>Jump<span class="token punctuation">.</span>canceled <span class="token operator">+=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputJump</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>Jump<span class="token punctuation">.</span><span class="token function">Enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>MoveKeyboardMouse<span class="token punctuation">.</span>performed <span class="token operator">+=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputMove</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>KeyboardMouse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>MoveKeyboardMouse<span class="token punctuation">.</span>canceled <span class="token operator">+=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputMove</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>KeyboardMouse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>MoveKeyboardMouse<span class="token punctuation">.</span><span class="token function">Enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>MoveGamepad<span class="token punctuation">.</span>performed <span class="token operator">+=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputMove</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>Gamepad<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>MoveGamepad<span class="token punctuation">.</span>canceled <span class="token operator">+=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputMove</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>Gamepad<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>MoveGamepad<span class="token punctuation">.</span><span class="token function">Enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>Sprint<span class="token punctuation">.</span>performed <span class="token operator">+=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputSprint</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>Sprint<span class="token punctuation">.</span>canceled <span class="token operator">+=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputSprint</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>Sprint<span class="token punctuation">.</span><span class="token function">Enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_spellDisabled<span class="token punctuation">)</span> <span class="token function">EnableSpell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellDirectionKeyboardMouse<span class="token punctuation">.</span><span class="token function">Enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellDirectionGamepad<span class="token punctuation">.</span><span class="token function">Enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Disables all control input actions.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DisableControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>Jump<span class="token punctuation">.</span>performed <span class="token operator">-=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputJump</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>Jump<span class="token punctuation">.</span>canceled <span class="token operator">-=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputJump</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>Jump<span class="token punctuation">.</span><span class="token function">Disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>MoveKeyboardMouse<span class="token punctuation">.</span>performed <span class="token operator">-=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputMove</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>KeyboardMouse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>MoveKeyboardMouse<span class="token punctuation">.</span>canceled <span class="token operator">-=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputMove</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>KeyboardMouse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>MoveKeyboardMouse<span class="token punctuation">.</span><span class="token function">Disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>MoveGamepad<span class="token punctuation">.</span>performed <span class="token operator">-=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputMove</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>Gamepad<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>MoveGamepad<span class="token punctuation">.</span>canceled <span class="token operator">-=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputMove</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>Gamepad<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>MoveGamepad<span class="token punctuation">.</span><span class="token function">Disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>Sprint<span class="token punctuation">.</span>performed <span class="token operator">-=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputSprint</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>Sprint<span class="token punctuation">.</span>canceled <span class="token operator">-=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputSprint</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>Sprint<span class="token punctuation">.</span><span class="token function">Disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">DisableSpell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellDirectionKeyboardMouse<span class="token punctuation">.</span><span class="token function">Disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellDirectionGamepad<span class="token punctuation">.</span><span class="token function">Disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Enables spell-casting inputs.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EnableSpell</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellKeyboardMouse<span class="token punctuation">.</span>performed <span class="token operator">+=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputSpell</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>KeyboardMouse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellKeyboardMouse<span class="token punctuation">.</span>canceled <span class="token operator">+=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputSpell</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>KeyboardMouse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellKeyboardMouse<span class="token punctuation">.</span><span class="token function">Enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellGamepad<span class="token punctuation">.</span>performed <span class="token operator">+=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputSpell</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>Gamepad<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellGamepad<span class="token punctuation">.</span>canceled <span class="token operator">+=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputSpell</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>Gamepad<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellGamepad<span class="token punctuation">.</span><span class="token function">Enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Disables spell-casting inputs.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DisableSpell</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellKeyboardMouse<span class="token punctuation">.</span>performed <span class="token operator">-=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputSpell</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>KeyboardMouse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellKeyboardMouse<span class="token punctuation">.</span>canceled <span class="token operator">-=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputSpell</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>KeyboardMouse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellKeyboardMouse<span class="token punctuation">.</span><span class="token function">Disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellGamepad<span class="token punctuation">.</span>performed <span class="token operator">-=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputSpell</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>Gamepad<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellGamepad<span class="token punctuation">.</span>canceled <span class="token operator">-=</span> context <span class="token operator">=&gt;</span> <span class="token function">InputSpell</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Control<span class="token punctuation">.</span>Gamepad<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">.</span>Controllable<span class="token punctuation">.</span>SpellGamepad<span class="token punctuation">.</span><span class="token function">Disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Called when jump input is pressed or released.</span>
  <span class="token comment">/// Handles normal and buffered jumps.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">InputJump</span><span class="token punctuation">(</span><span class="token class-name">InputAction<span class="token punctuation">.</span>CallbackContext</span> context<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">ChangeControl</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _isJumping <span class="token operator">=</span> context<span class="token punctuation">.</span>performed<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>performed<span class="token punctuation">)</span> <span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token function">InputJumpCoroutine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Coroutine that handles buffered jump logic and ongoing jump execution.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token return-type class-name">IEnumerator</span> <span class="token function">InputJumpCoroutine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">RefreshCanJump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_canJump<span class="token punctuation">)</span> _jumpBuffer<span class="token punctuation">.</span><span class="token function">Restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>_canJump <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>_jumpBuffer<span class="token punctuation">.</span><span class="token function">IsOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token function">RefreshCanJump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    _isJumping <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token function">JumpStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>_isJumping<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token function">JumpPerform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">JumpCancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Handles movement input from keyboard/mouse or gamepad.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">InputMove</span><span class="token punctuation">(</span><span class="token class-name">InputAction<span class="token punctuation">.</span>CallbackContext</span> context<span class="token punctuation">,</span> <span class="token class-name">Control</span> control<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Update which control scheme is currently active</span>
    GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">ChangeControl</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>performed<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>control <span class="token operator">==</span> Control<span class="token punctuation">.</span>KeyboardMouse<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        _moveDirection<span class="token punctuation">.</span>x <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">RoundToInt</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ReadValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">float</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Count how many times movement key was pressed (1 or 2, cycles)</span>
        <span class="token comment">// Used to detect double-tap for direction flip</span>
        _moveInputPressed <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> _moveInputPressed <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">;</span>

        <span class="token comment">// If the previous direction was right AND the current is right AND this is the second press then flip direction</span>
        <span class="token comment">// This make sure the player always go where he want</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_moveDirectionOld<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>right <span class="token operator">&amp;&amp;</span> _moveDirection<span class="token punctuation">.</span>vector2 <span class="token operator">==</span> Vector2<span class="token punctuation">.</span>right <span class="token operator">&amp;&amp;</span> _moveInputPressed <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> _moveDirection<span class="token punctuation">.</span><span class="token function">Opposite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        _moveDirectionOld <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Direction2</span><span class="token punctuation">(</span>_moveDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span> _moveDirection<span class="token punctuation">.</span>x <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Round</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ReadValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Vector2<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_isMoving <span class="token operator">&amp;&amp;</span> _moveDirection<span class="token punctuation">.</span>x <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token function">InputMoveCoroutine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
      _moveDirectionOld<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      _moveInputPressed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_moveDirection<span class="token punctuation">.</span>x <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> _isMoving <span class="token operator">=</span> context<span class="token punctuation">.</span>performed<span class="token punctuation">;</span>
    <span class="token keyword">else</span> _isMoving <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Coroutine that handles ongoing movement execution.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token return-type class-name">IEnumerator</span> <span class="token function">InputMoveCoroutine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _isMoving <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token function">MoveStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Execute as long as the player is holding the direction</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>_isMoving <span class="token operator">&amp;&amp;</span> _moveDirection<span class="token punctuation">.</span>x <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token function">MovePerform</span><span class="token punctuation">(</span>_moveDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WaitForFixedUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">MoveCancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Handles sprint input being pressed or released.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">InputSprint</span><span class="token punctuation">(</span><span class="token class-name">InputAction<span class="token punctuation">.</span>CallbackContext</span> context<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">ChangeControl</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>performed<span class="token punctuation">)</span> <span class="token function">SprintStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token function">SprintCancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _isSprinting <span class="token operator">=</span> context<span class="token punctuation">.</span>performed<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Handles spell input for keyboard/mouse or gamepad.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">InputSpell</span><span class="token punctuation">(</span><span class="token class-name">InputAction<span class="token punctuation">.</span>CallbackContext</span> context<span class="token punctuation">,</span> <span class="token class-name">Control</span> control<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">ChangeControl</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _wand<span class="token punctuation">.</span><span class="token function">InputSpell</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> control<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// Indicates which control scheme generated input.</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Control</span>
<span class="token punctuation">{</span>
  KeyboardMouse<span class="token punctuation">,</span>
  Gamepad
<span class="token punctuation">}</span></code>
</pre>

<h4>Soft body</h4>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Softbody.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Softbody-editor.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<pre class="language-csharp" tabindex="0"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SoftBodySprite</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">// Reference to the protagonist to get bone positions.</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token class-name">ProtagonistActor</span> _protagonist<span class="token punctuation">;</span>

    <span class="token comment">// MeshRenderer for the main body mesh.</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token class-name">MeshRenderer</span> _meshRenderer<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">MeshRenderer</span> meshRenderer <span class="token operator">=&gt;</span> _meshRenderer<span class="token punctuation">;</span>

    <span class="token comment">// MeshFilter for the main body mesh.</span>
    <span class="token class-name">MeshFilter</span> _meshFilter<span class="token punctuation">;</span>

    <span class="token comment">// MeshRenderer for the outline mesh.</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token class-name">MeshRenderer</span> _outlineMeshRenderer<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">MeshRenderer</span> outlineMeshRenderer <span class="token operator">=&gt;</span> _outlineMeshRenderer<span class="token punctuation">;</span>

    <span class="token comment">// MeshFilter for the outline mesh.</span>
    <span class="token class-name">MeshFilter</span> _outlineMeshFilter<span class="token punctuation">;</span>

    <span class="token comment">// Total number of bones in the protagonist.</span>
    <span class="token class-name"><span class="token keyword">int</span></span> _boneAmount<span class="token punctuation">;</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _boneAmount <span class="token operator">=</span> _protagonist<span class="token punctuation">.</span>bones<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>

        _meshFilter <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MeshFilter<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _outlineMeshFilter <span class="token operator">=</span> _outlineMeshRenderer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MeshFilter<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Updates the soft body mesh every frame based on current bone positions.</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Mesh</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Mesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Vector3<span class="token punctuation">[</span><span class="token punctuation">]</span></span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">[</span>_boneAmount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">Vector2<span class="token punctuation">[</span><span class="token punctuation">]</span></span> uv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">[</span>_boneAmount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> triangles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span></span><span class="token punctuation">[</span><span class="token punctuation">(</span>_boneAmount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        vertices<span class="token punctuation">[</span>_boneAmount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">int</span></span> trianglesIndex<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> nextVerticesIndex<span class="token punctuation">;</span>
        
        <span class="token comment">// Loop through bones to set vertices, UVs, and triangle indices</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _boneAmount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">Bone</span> bone <span class="token operator">=</span> _protagonist<span class="token punctuation">.</span>bones<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token comment">// Vertex position matches bone local position</span>
            vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> bone<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>localPosition<span class="token punctuation">;</span>
            uv<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> bone<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>localPosition<span class="token punctuation">;</span>

            trianglesIndex <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>
            nextVerticesIndex <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_boneAmount <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">==</span> i<span class="token punctuation">)</span> nextVerticesIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

            triangles<span class="token punctuation">[</span>trianglesIndex<span class="token punctuation">]</span> <span class="token operator">=</span> _boneAmount<span class="token punctuation">;</span>
            triangles<span class="token punctuation">[</span>trianglesIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
            triangles<span class="token punctuation">[</span>trianglesIndex <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> nextVerticesIndex<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        mesh<span class="token punctuation">.</span>vertices <span class="token operator">=</span> vertices<span class="token punctuation">;</span>
        mesh<span class="token punctuation">.</span>uv <span class="token operator">=</span> uv<span class="token punctuation">;</span>
        mesh<span class="token punctuation">.</span>triangles <span class="token operator">=</span> triangles<span class="token punctuation">;</span>

        _meshFilter<span class="token punctuation">.</span>mesh <span class="token operator">=</span> mesh<span class="token punctuation">;</span>
        _outlineMeshFilter<span class="token punctuation">.</span>mesh <span class="token operator">=</span> mesh<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bone</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
  <span class="token comment">// Reference to the protagonist actor.</span>
  <span class="token class-name">ProtagonistActor</span> _protagonist<span class="token punctuation">;</span>

  <span class="token comment">// Game settings reference.</span>
  <span class="token class-name">GeneralSetting</span> _setting<span class="token punctuation">;</span>

  <span class="token comment">// Rigidbody of this bone.</span>
  <span class="token class-name">Rigidbody2D</span> _rb2D<span class="token punctuation">;</span>

  <span class="token comment">// Spring joints connected to this bone.</span>
  <span class="token class-name">SpringJoint2D<span class="token punctuation">[</span><span class="token punctuation">]</span></span> _springJoint2Ds<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">SpringJoint2D<span class="token punctuation">[</span><span class="token punctuation">]</span></span> springJoint2Ds <span class="token operator">=&gt;</span> _springJoint2Ds<span class="token punctuation">;</span>

  <span class="token comment">// Hinge joint for connecting bones.</span>
  <span class="token class-name">HingeJoint2D</span> _hingeJoint2D<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">HingeJoint2D</span> hingeJoint2D <span class="token operator">=&gt;</span> _hingeJoint2D<span class="token punctuation">;</span>

  <span class="token comment">// Collider representing this bone.</span>
  <span class="token class-name">CircleCollider2D</span> _circleCollider2D<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">CircleCollider2D</span> circleCollider2D <span class="token operator">=&gt;</span> _circleCollider2D<span class="token punctuation">;</span>

  <span class="token comment">// Original radius of the circle collider.</span>
  <span class="token class-name"><span class="token keyword">float</span></span> _circleColliderRaduis<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> circleColliderRaduis <span class="token operator">=&gt;</span> _circleColliderRaduis<span class="token punctuation">;</span>

  <span class="token comment">// Starting local position of the bone.</span>
  <span class="token class-name">Vector2</span> _startPosition<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">Vector2</span> startPosition <span class="token operator">=&gt;</span> _startPosition<span class="token punctuation">;</span>

  <span class="token comment">// Starting local rotation of the bone.</span>
  <span class="token class-name"><span class="token keyword">float</span></span> _startRotation<span class="token punctuation">;</span>

  <span class="token comment">// Initial distances and anchors for all spring joints.</span>
  <span class="token class-name"><span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> _springJoint2DsInitialDistance<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> springJoint2DsInitialDistance <span class="token operator">=&gt;</span> _springJoint2DsInitialDistance<span class="token punctuation">;</span>

  <span class="token class-name">Vector2<span class="token punctuation">[</span><span class="token punctuation">]</span></span> _springJoint2DsInitialAnchor<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">Vector2<span class="token punctuation">[</span><span class="token punctuation">]</span></span> springJoint2DsInitialAnchor <span class="token operator">=&gt;</span> _springJoint2DsInitialAnchor<span class="token punctuation">;</span>

  <span class="token comment">// Original anchor for the hinge joint.</span>
  <span class="token class-name">Vector2</span> _hingeJoint2DInitialAnchor<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">Vector2</span> hingeJoint2DInitialAnchor <span class="token operator">=&gt;</span> _hingeJoint2DInitialAnchor<span class="token punctuation">;</span>

  <span class="token comment">// Direction vector pointing outward from bone rotation.</span>
  <span class="token class-name">Direction2</span> _directionOutside<span class="token punctuation">;</span>

  <span class="token comment">// Vector from current position to starting position.</span>
  <span class="token class-name">Vector2</span> _distancePositionToStart<span class="token punctuation">;</span>

  <span class="token comment">// Raycast hit info for outer and inner collisions.</span>
  <span class="token class-name">RaycastHit2D</span> _touchOutside<span class="token punctuation">;</span>
  <span class="token class-name">RaycastHit2D</span> _touchInside<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _protagonist <span class="token operator">=</span> GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>protagonist<span class="token punctuation">;</span>
    _setting <span class="token operator">=</span> GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>setting<span class="token punctuation">;</span>

    _rb2D <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rigidbody2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _circleCollider2D <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CircleCollider2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _circleColliderRaduis <span class="token operator">=</span> _circleCollider2D<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>

    _springJoint2Ds <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponents</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SpringJoint2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _springJoint2DsInitialAnchor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">[</span>_springJoint2Ds<span class="token punctuation">.</span>Length<span class="token punctuation">]</span><span class="token punctuation">;</span>
    _springJoint2DsInitialDistance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">float</span></span><span class="token punctuation">[</span>_springJoint2Ds<span class="token punctuation">.</span>Length<span class="token punctuation">]</span><span class="token punctuation">;</span>

    _hingeJoint2D <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>HingeJoint2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _hingeJoint2DInitialAnchor <span class="token operator">=</span> _hingeJoint2D<span class="token punctuation">.</span>connectedAnchor<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _springJoint2Ds<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      _springJoint2DsInitialAnchor<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> _springJoint2Ds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>connectedAnchor<span class="token punctuation">;</span>
      _springJoint2DsInitialDistance<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> _springJoint2Ds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>distance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    _startPosition <span class="token operator">=</span> transform<span class="token punctuation">.</span>localPosition<span class="token punctuation">;</span>
    _startRotation <span class="token operator">=</span> transform<span class="token punctuation">.</span>localEulerAngles<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">FixedUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _distancePositionToStart <span class="token operator">=</span> _startPosition <span class="token operator">*</span> _protagonist<span class="token punctuation">.</span>scaleFromHealthLeft <span class="token operator">-</span> <span class="token punctuation">(</span>Vector2<span class="token punctuation">)</span>transform<span class="token punctuation">.</span>localPosition<span class="token punctuation">;</span>

    _directionOutside <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Direction2</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>eulerAngles<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Raycast if it can hit anything outside</span>
    _touchOutside <span class="token operator">=</span> Physics2D<span class="token punctuation">.</span><span class="token function">Raycast</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> _directionOutside<span class="token punctuation">.</span>vector2<span class="token punctuation">,</span> _circleCollider2D<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>extents<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token number">2f</span><span class="token punctuation">,</span> _setting<span class="token punctuation">.</span>groundLayer <span class="token operator">|</span> _setting<span class="token punctuation">.</span>damager<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Raycast if it can hit anything inside the soft body</span>
    _touchInside <span class="token operator">=</span> Physics2D<span class="token punctuation">.</span><span class="token function">Raycast</span><span class="token punctuation">(</span>_protagonist<span class="token punctuation">.</span>body<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> transform<span class="token punctuation">.</span>localPosition<span class="token punctuation">.</span>normalized<span class="token punctuation">,</span> transform<span class="token punctuation">.</span>localPosition<span class="token punctuation">.</span>magnitude <span class="token operator">-</span> circleCollider2D<span class="token punctuation">.</span>radius<span class="token punctuation">,</span> _setting<span class="token punctuation">.</span>groundLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_protagonist<span class="token punctuation">.</span>brainDead<span class="token punctuation">)</span> <span class="token function">Splash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">AddBoneVelocity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// we reposition if there is a wall inside</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_touchInside<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      transform<span class="token punctuation">.</span>position <span class="token operator">=</span> _touchInside<span class="token punctuation">.</span>point <span class="token operator">-</span> <span class="token punctuation">(</span>Vector2<span class="token punctuation">)</span>transform<span class="token punctuation">.</span>localPosition<span class="token punctuation">.</span>normalized <span class="token operator">*</span> circleCollider2D<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    transform<span class="token punctuation">.</span>localEulerAngles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>localEulerAngles<span class="token punctuation">.</span>x<span class="token punctuation">,</span> transform<span class="token punctuation">.</span>localEulerAngles<span class="token punctuation">.</span>y<span class="token punctuation">,</span> _startRotation<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Applies velocity to keep bone close to its original position.</span>
  <span class="token comment">/// Adds extra force when protagonist is on ground or walls.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddBoneVelocity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Calculate normalized directions for comparison</span>
    <span class="token class-name">Vector2</span> currentDir <span class="token operator">=</span> transform<span class="token punctuation">.</span>localPosition<span class="token punctuation">.</span>normalized<span class="token punctuation">;</span>
    <span class="token class-name">Vector2</span> targetDir <span class="token operator">=</span> <span class="token punctuation">(</span>_startPosition <span class="token operator">*</span> _protagonist<span class="token punctuation">.</span>scaleFromHealthLeft<span class="token punctuation">)</span><span class="token punctuation">.</span>normalized<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>Vector2<span class="token punctuation">.</span><span class="token function">Dot</span><span class="token punctuation">(</span>currentDir<span class="token punctuation">,</span> targetDir<span class="token punctuation">.</span>normalized<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">.6f</span> <span class="token operator">||</span> transform<span class="token punctuation">.</span>localPosition<span class="token punctuation">.</span>magnitude <span class="token operator">&lt;</span> <span class="token number">.4f</span> <span class="token operator">*</span> _protagonist<span class="token punctuation">.</span>scaleFromHealthLeft<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// If the bone is too misaligned or too close to the center, apply a stronger corrective force</span>

      _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">*</span> <span class="token number">.3f</span> <span class="token operator">+</span> _distancePositionToStart<span class="token punctuation">.</span>normalized <span class="token operator">*</span> _rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>magnitude <span class="token operator">*</span> <span class="token number">1.3f</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// If the bone is in a normal range, apply environmental effects</span>

      <span class="token comment">// Apply downward pull if the protagonist is on the ground</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_protagonist<span class="token punctuation">.</span>isOnGround<span class="token punctuation">)</span> _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">+</span> Vector2<span class="token punctuation">.</span>down <span class="token operator">*</span> _protagonist<span class="token punctuation">.</span>scaleFromHealthLeft<span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_protagonist<span class="token punctuation">.</span>isOnWall<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// Apply lateral push if the protagonist is on a wall</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_protagonist<span class="token punctuation">.</span>isOnLeftWall<span class="token punctuation">)</span> _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">+</span> Vector2<span class="token punctuation">.</span>left <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> _protagonist<span class="token punctuation">.</span>scaleFromHealthLeft<span class="token punctuation">;</span>
        <span class="token keyword">else</span> _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">+</span> Vector2<span class="token punctuation">.</span>right <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> _protagonist<span class="token punctuation">.</span>scaleFromHealthLeft<span class="token punctuation">;</span> <span class="token comment">// is on right wall</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// Add corrective force toward start position</span>
      _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> _rb2D<span class="token punctuation">.</span>velocity <span class="token operator">+</span> _distancePositionToStart <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Creates a splatter effect when bone touches surfaces.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Splash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_touchOutside <span class="token operator">||</span> _protagonist<span class="token punctuation">.</span>isInLiquid<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token class-name">Decoration</span> decoration <span class="token operator">=</span> _touchOutside<span class="token punctuation">.</span>transform<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Decoration<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Heavy</span> heavy <span class="token operator">=</span> _touchOutside<span class="token punctuation">.</span>transform<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Heavy<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>decoration <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> heavy <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token comment">// Avoid duplicate splatter on same parent</span>
    <span class="token class-name">Collider2D<span class="token punctuation">[</span><span class="token punctuation">]</span></span> colliders2D <span class="token operator">=</span> Physics2D<span class="token punctuation">.</span><span class="token function">OverlapBoxAll</span><span class="token punctuation">(</span>_touchOutside<span class="token punctuation">.</span>point<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>_setting<span class="token punctuation">.</span>splatterAmount<span class="token punctuation">,</span> _setting<span class="token punctuation">.</span>splatterAmount<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> _setting<span class="token punctuation">.</span>splatterLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Collider2D</span> collider2D <span class="token keyword">in</span> colliders2D<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>collider2D<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>parent <span class="token operator">==</span> _touchOutside<span class="token punctuation">.</span>transform<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Use the next splatter in protagonist's array</span>
    <span class="token class-name">Splatter</span> splatter <span class="token operator">=</span> _protagonist<span class="token punctuation">.</span>splatters<span class="token punctuation">[</span>_protagonist<span class="token punctuation">.</span>indexSplatterToUse<span class="token punctuation">]</span><span class="token punctuation">;</span>

    _protagonist<span class="token punctuation">.</span>indexSplatterToUse<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_protagonist<span class="token punctuation">.</span>indexSplatterToUse <span class="token operator">&gt;=</span> _protagonist<span class="token punctuation">.</span>splatters<span class="token punctuation">.</span>Length<span class="token punctuation">)</span> _protagonist<span class="token punctuation">.</span>indexSplatterToUse <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    splatter<span class="token punctuation">.</span>maxSize <span class="token operator">=</span> _protagonist<span class="token punctuation">.</span>scaleFromHealthLeft <span class="token operator">*</span> <span class="token number">0.2f</span> <span class="token operator">+</span> <span class="token number">0.15f</span><span class="token punctuation">;</span>
    splatter<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">=</span> _protagonist<span class="token punctuation">.</span>body<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">;</span>
    splatter<span class="token punctuation">.</span>positionToGo <span class="token operator">=</span> _touchOutside<span class="token punctuation">.</span>point<span class="token punctuation">;</span>
    splatter<span class="token punctuation">.</span>color <span class="token operator">=</span> _protagonist<span class="token punctuation">.</span>splatterColor<span class="token punctuation">;</span>
    splatter<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>parent <span class="token operator">=</span> _touchOutside<span class="token punctuation">.</span>transform<span class="token punctuation">;</span>

    <span class="token comment">// Set sorting layer and order</span>
    <span class="token class-name">SpriteRenderer</span> touchOutsideSpriteRender <span class="token operator">=</span> _touchOutside<span class="token punctuation">.</span>collider<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponentInChildren</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SpriteRenderer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>touchOutsideSpriteRender <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">SpriteRenderer</span> splatterSpriteRender <span class="token operator">=</span> splatter<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponentInChildren</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SpriteRenderer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      splatterSpriteRender<span class="token punctuation">.</span>sortingLayerName <span class="token operator">=</span> touchOutsideSpriteRender<span class="token punctuation">.</span>sortingLayerName<span class="token punctuation">;</span>
      splatterSpriteRender<span class="token punctuation">.</span>sortingOrder <span class="token operator">=</span> touchOutsideSpriteRender<span class="token punctuation">.</span>sortingOrder <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    splatter<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code>
</pre>

<h4>Tutorial</h4>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Remaping.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Tutorial-ghost.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <img src="Images/Contents/TheMeltyWay/Tutorial.jpg" loading="lazy">
</div>

<div class="image-video-container">
  <img src="Images/Contents/TheMeltyWay/Controller-remaping.jpg" loading="lazy">
</div>

<h3 id="Hazards-TheMeltyWay">Hazards</h3>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Hazards-movement.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<ul>
  <li>Spikes: Basic damage</li>
  <li>Saws: Follow programmed movement patterns</li>
  <li>Lasers: Periodic damage with visual indicators</li>
  <li>Cannons: Fire projectiles periodically</li>
  <li>Sticky surfaces: Prevent jumping</li>
  <li>Slippery surfaces: Provide a glide effect similar to ice</li>
  <li>Conveyors: Apply automatic directional movement</li>
  <li>Anvils: Movable if the player's size allows. Can be ridden and jumped off</li>
</ul>

<h4>Laser</h4>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Laser.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<pre class="language-csharp" tabindex="0"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Laser</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Shooter</span></span>
<span class="token punctuation">{</span>

    <span class="token comment">// Amount of damage the laser deals to the protagonist</span>
    <span class="token punctuation">[</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">int</span></span> _damage<span class="token punctuation">;</span>

    <span class="token comment">// Main laser sprite renderer</span>
    <span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token class-name">SpriteRenderer</span> _laserSpriteRenderer<span class="token punctuation">;</span>

    <span class="token comment">// Center sprite renderer for laser effects (glow, color adjustments)</span>
    <span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token class-name">SpriteRenderer</span> _laserCenterSpriteRenderer<span class="token punctuation">;</span>

    <span class="token comment">// 2D lights for laser visual effect</span>
    <span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token class-name">Light2D</span> _laserLight<span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token class-name">Light2D</span> _laserSpotLight<span class="token punctuation">;</span>

    <span class="token comment">// Base transform of the laser (start position)</span>
    <span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token class-name">GameObject</span> _laserBase<span class="token punctuation">;</span>

    <span class="token comment">// Initial values for lights and laser scale</span>
    <span class="token class-name"><span class="token keyword">float</span></span> _laserLightIntensityStart<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">float</span></span> _laserSpotLightIntensityStart<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">float</span></span> _laserSpotLightSizeStart<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">float</span></span> _startLaserWidth<span class="token punctuation">;</span>

    <span class="token comment">// Material used for center glow effect</span>
    <span class="token class-name">Material</span> _laserCenterMaterial<span class="token punctuation">;</span>

    <span class="token comment">// Direction vector of the laser</span>
    <span class="token class-name">Direction2</span> _directionLaser<span class="token punctuation">;</span>

    <span class="token comment">// Collider for laser hit detection</span>
    <span class="token class-name">BoxCollider2D</span> _boxCollider<span class="token punctuation">;</span>

    <span class="token comment">// Timers for pre-shoot delay and active shooting duration</span>
    <span class="token class-name">Timer</span> _shootBeforeTimer<span class="token punctuation">;</span>
    <span class="token class-name">Timer</span> _shootingTimer<span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        _boxCollider <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BoxCollider2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TouchEnter<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onTouch <span class="token operator">+=</span> OnTouchEnterAddOn<span class="token punctuation">;</span>

        _laserCenterMaterial <span class="token operator">=</span> _laserCenterSpriteRenderer<span class="token punctuation">.</span>material<span class="token punctuation">;</span>
        _laserLightIntensityStart <span class="token operator">=</span> _laserLight<span class="token punctuation">.</span>intensity<span class="token punctuation">;</span>
        _laserSpotLightIntensityStart <span class="token operator">=</span> _laserSpotLight<span class="token punctuation">.</span>intensity<span class="token punctuation">;</span>

        _startLaserWidth <span class="token operator">=</span> _laserSpriteRenderer<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>localScale<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
        _laserSpotLightSizeStart <span class="token operator">=</span> _laserSpotLight<span class="token punctuation">.</span>pointLightOuterRadius<span class="token punctuation">;</span>
        _boxCollider<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        _shootBeforeTimer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Timer</span><span class="token punctuation">(</span>_setting<span class="token punctuation">.</span>durationBeforeLaser<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _shootingTimer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Timer</span><span class="token punctuation">(</span>_setting<span class="token punctuation">.</span>durationLaser<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">ResetLaserVisuals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">RefreshLaser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Handles damage and visual effects when laser touches the protagonist.</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnTouchEnterAddOn</span><span class="token punctuation">(</span><span class="token class-name">Collider2D</span> touched<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">ProtagonistActor</span> protagonistActor <span class="token operator">=</span> touched<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ProtagonistActor<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        protagonistActor<span class="token punctuation">.</span>healthManager<span class="token punctuation">.</span><span class="token function">Hurt</span><span class="token punctuation">(</span>_damage<span class="token punctuation">,</span> gameObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>protagonistActor<span class="token punctuation">.</span>healthManager<span class="token punctuation">.</span>isDead<span class="token punctuation">)</span> protagonistActor<span class="token punctuation">.</span>sFXManager<span class="token punctuation">.</span><span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token string">"SpikeDeath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _sFXManager<span class="token punctuation">.</span><span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token string">"LaserHit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Calculate position directly under protagonist along laser</span>
        <span class="token class-name">Vector2</span> hitPosition <span class="token operator">=</span> _directionLaser<span class="token punctuation">.</span>vector2 <span class="token operator">*</span> Vector2<span class="token punctuation">.</span><span class="token function">Distance</span><span class="token punctuation">(</span>protagonistActor<span class="token punctuation">.</span>body<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> _laserBase<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Vector2</span> underProtagonistPos <span class="token operator">=</span> <span class="token punctuation">(</span>Vector2<span class="token punctuation">)</span>_laserBase<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">+</span> hitPosition<span class="token punctuation">;</span>

        <span class="token comment">// Push protagonist away from laser hit</span>
        protagonistActor<span class="token punctuation">.</span>rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Direction2</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Vector2<span class="token punctuation">)</span>protagonistActor<span class="token punctuation">.</span>body<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">-</span> underProtagonistPos<span class="token punctuation">)</span><span class="token punctuation">.</span>vector2 <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">;</span>

        <span class="token class-name">ParticleSystem</span> impactFlash <span class="token operator">=</span> protagonistActor<span class="token punctuation">.</span>vFXManager<span class="token punctuation">.</span>particles<span class="token punctuation">[</span><span class="token string">"ImpactFlashParticles"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        impactFlash<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">=</span> underProtagonistPos<span class="token punctuation">;</span>
        impactFlash<span class="token punctuation">.</span><span class="token function">Play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Coroutine controlling laser shooting behavior with intervals and visuals.</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">IEnumerator</span> <span class="token function">ShootWInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        _shootIntervalTimer<span class="token punctuation">.</span><span class="token function">Restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span>_isShootingWInterval<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_shootIntervalTimer<span class="token punctuation">.</span><span class="token function">IsOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Pre-shoot glow and sound</span>
                _laserCenterSpriteRenderer<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Color</span><span class="token punctuation">(</span>_laserCenterSpriteRenderer<span class="token punctuation">.</span>color<span class="token punctuation">.</span>r<span class="token punctuation">,</span> _laserCenterSpriteRenderer<span class="token punctuation">.</span>color<span class="token punctuation">.</span>g<span class="token punctuation">,</span> _laserCenterSpriteRenderer<span class="token punctuation">.</span>color<span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                _shootBeforeTimer<span class="token punctuation">.</span><span class="token function">Restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                _sFXManager<span class="token punctuation">.</span><span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token string">"LaserStartShooting"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                _laserCenterMaterial<span class="token punctuation">.</span><span class="token function">SetColor</span><span class="token punctuation">(</span><span class="token string">"_Color"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Color</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                _laserCenterMaterial<span class="token punctuation">.</span><span class="token function">SetFloat</span><span class="token punctuation">(</span><span class="token string">"_Contrast"</span><span class="token punctuation">,</span> <span class="token number">0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                _laserSpriteRenderer<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>localScale <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>_startLaserWidth<span class="token punctuation">,</span> _laserSpriteRenderer<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>localScale<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Pre-shoot animation</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>_shootBeforeTimer<span class="token punctuation">.</span><span class="token function">IsOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token class-name"><span class="token keyword">float</span></span> percentage <span class="token operator">=</span> _shootBeforeTimer<span class="token punctuation">.</span><span class="token function">PercentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    _laserSpotLight<span class="token punctuation">.</span>intensity <span class="token operator">=</span> _laserSpotLightIntensityStart <span class="token operator">*</span> percentage <span class="token operator">*</span> <span class="token number">.6f</span><span class="token punctuation">;</span>
                    _laserCenterSpriteRenderer<span class="token punctuation">.</span>color <span class="token operator">=</span> _laserCenterSpriteRenderer<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">SetAlpha</span><span class="token punctuation">(</span>percentage <span class="token operator">*</span> <span class="token number">.7f</span> <span class="token operator">+</span> <span class="token number">.1f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">RefreshLaser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// If laser toggle was deactivated mid-pre-shoot, reset visuals</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>_toggle<span class="token punctuation">.</span>isActive<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token function">ResetLaserVisuals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                _laserSpriteRenderer<span class="token punctuation">.</span>color <span class="token operator">=</span> _laserSpriteRenderer<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">SetAlpha</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                _laserCenterMaterial<span class="token punctuation">.</span><span class="token function">SetColor</span><span class="token punctuation">(</span><span class="token string">"_Color"</span><span class="token punctuation">,</span> Color<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">;</span>
                _laserCenterMaterial<span class="token punctuation">.</span><span class="token function">SetFloat</span><span class="token punctuation">(</span><span class="token string">"_Contrast"</span><span class="token punctuation">,</span> <span class="token number">2.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                _vFXManager<span class="token punctuation">.</span>particles<span class="token punctuation">[</span><span class="token string">"LaserSmokeParticles"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                _sFXManager<span class="token punctuation">.</span><span class="token function">StopSound</span><span class="token punctuation">(</span><span class="token string">"LaserShooting"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                _sFXManager<span class="token punctuation">.</span><span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token string">"LaserShooting"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                _boxCollider<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

                _shootingTimer<span class="token punctuation">.</span><span class="token function">Restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Timer</span> laserSizeChangeTimer <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token number">.2f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">float</span></span> laserSizeChangeInverter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

                <span class="token comment">// Active shooting animation</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>_shootingTimer<span class="token punctuation">.</span><span class="token function">IsOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>laserSizeChangeTimer<span class="token punctuation">.</span><span class="token function">IsOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token class-name"><span class="token keyword">float</span></span> percentage <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>laserSizeChangeInverter <span class="token operator">-</span> laserSizeChangeTimer<span class="token punctuation">.</span><span class="token function">PercentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        _laserLight<span class="token punctuation">.</span>intensity <span class="token operator">=</span> _laserLightIntensityStart <span class="token operator">*</span> percentage <span class="token operator">*</span> <span class="token number">1.2f</span><span class="token punctuation">;</span>
                        _laserSpriteRenderer<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>localScale <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>_startLaserWidth <span class="token operator">*</span> percentage<span class="token punctuation">,</span> _laserSpriteRenderer<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>localScale<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        _laserSpotLight<span class="token punctuation">.</span>intensity <span class="token operator">=</span> _laserLightIntensityStart <span class="token operator">*</span> <span class="token number">.6f</span> <span class="token operator">+</span> _laserLightIntensityStart <span class="token operator">*</span> percentage <span class="token operator">*</span> <span class="token number">.6f</span><span class="token punctuation">;</span>
                        _laserSpotLight<span class="token punctuation">.</span>pointLightOuterRadius <span class="token operator">=</span> _laserSpotLightSizeStart <span class="token operator">+</span> percentage <span class="token operator">*</span> _laserSpotLightSizeStart<span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>laserSizeChangeTimer<span class="token punctuation">.</span><span class="token function">PercentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">.8f</span><span class="token punctuation">)</span> _boxCollider<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_shootingTimer<span class="token punctuation">.</span><span class="token function">TimeLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> laserSizeChangeTimer<span class="token punctuation">.</span>duration<span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        laserSizeChangeTimer<span class="token punctuation">.</span><span class="token function">Restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        laserSizeChangeInverter <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token function">RefreshLaser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// Stop laser visuals and sound</span>
                _sFXManager<span class="token punctuation">.</span><span class="token function">StopSound</span><span class="token punctuation">(</span><span class="token string">"LaserShooting"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">ResetLaserVisuals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                _shootIntervalTimer<span class="token punctuation">.</span><span class="token function">Restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Updates laser collider, light and sprite scale based on environment hits.</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RefreshLaser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _directionLaser <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>rotation <span class="token operator">*</span> Vector3<span class="token punctuation">.</span>up<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RaycastHit2D</span> hit <span class="token operator">=</span> Physics2D<span class="token punctuation">.</span><span class="token function">Raycast</span><span class="token punctuation">(</span>_laserBase<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> _directionLaser<span class="token punctuation">.</span>vector2<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_setting<span class="token punctuation">.</span>groundLayer <span class="token operator">|</span> _setting<span class="token punctuation">.</span>notGroundLayer<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token operator">~</span>_setting<span class="token punctuation">.</span>damager<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>hit<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">Vector2</span> dimensionLaser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>_boxCollider<span class="token punctuation">.</span>size<span class="token punctuation">.</span>x<span class="token punctuation">,</span> Vector2<span class="token punctuation">.</span><span class="token function">Distance</span><span class="token punctuation">(</span>hit<span class="token punctuation">.</span>point<span class="token punctuation">,</span> _laserBase<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _boxCollider<span class="token punctuation">.</span>size <span class="token operator">=</span> dimensionLaser<span class="token punctuation">;</span>
            _laserSpriteRenderer<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>localScale <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>_laserSpriteRenderer<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>localScale<span class="token punctuation">.</span>x<span class="token punctuation">,</span> dimensionLaser<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">.75f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            transform<span class="token punctuation">.</span>localPosition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>localPosition<span class="token punctuation">.</span>x<span class="token punctuation">,</span> dimensionLaser<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            _laserLight<span class="token punctuation">.</span>shapePath<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">.01f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _laserLight<span class="token punctuation">.</span>shapePath<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">.01f</span><span class="token punctuation">,</span> dimensionLaser<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">.75f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _laserLight<span class="token punctuation">.</span>shapePath<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">.01f</span><span class="token punctuation">,</span> dimensionLaser<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">.75f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _laserLight<span class="token punctuation">.</span>shapePath<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">.01f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            _vFXManager<span class="token punctuation">.</span>particles<span class="token punctuation">[</span><span class="token string">"LaserSmokeParticles"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">=</span> hit<span class="token punctuation">.</span>point<span class="token punctuation">;</span>
            _laserSpotLight<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">=</span> hit<span class="token punctuation">.</span>point<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Resets laser visuals and disables collider</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ResetLaserVisuals</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _laserSpriteRenderer<span class="token punctuation">.</span>color <span class="token operator">=</span> _laserSpriteRenderer<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">SetAlpha</span><span class="token punctuation">(</span><span class="token number">0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _laserCenterSpriteRenderer<span class="token punctuation">.</span>color <span class="token operator">=</span> _laserCenterSpriteRenderer<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">SetAlpha</span><span class="token punctuation">(</span><span class="token number">0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _laserLight<span class="token punctuation">.</span>intensity <span class="token operator">=</span> <span class="token number">0f</span><span class="token punctuation">;</span>
        _laserSpotLight<span class="token punctuation">.</span>intensity <span class="token operator">=</span> <span class="token number">0f</span><span class="token punctuation">;</span>
        _boxCollider<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        _vFXManager<span class="token punctuation">.</span>particles<span class="token punctuation">[</span><span class="token string">"LaserSmokeParticles"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code>
</pre>

<h4>Conveyors</h4>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Conveyors-up.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Conveyors-left.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<pre class="language-csharp" tabindex="0"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Conveyor</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
  <span class="token comment">// Reference to the ClassicToggle component, used to enable/disable the conveyor</span>
  <span class="token class-name">ClassicToggle</span> _toggle<span class="token punctuation">;</span>
  <span class="token comment">// Reference to the CapsuleCollider2D if present (used for round-ended conveyors)</span>
  <span class="token class-name">CapsuleCollider2D</span> _capsuleColliders2D<span class="token punctuation">;</span>
  <span class="token comment">// Reference to the BoxCollider2D if CapsuleCollider2D is not present</span>
  <span class="token class-name">BoxCollider2D</span> _boxCollider2D<span class="token punctuation">;</span>
  <span class="token comment">// Half the length of the conveyor belt (calculated from the collider size)</span>
  <span class="token class-name"><span class="token keyword">float</span></span> _conveyorHalfLength<span class="token punctuation">;</span>
  <span class="token comment">// Flag to determine if the conveyor is oriented horizontally</span>
  <span class="token class-name"><span class="token keyword">bool</span></span> _isHorizontal<span class="token punctuation">;</span>
  <span class="token comment">// The force magnitude and direction applied by the conveyor.</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">float</span></span> _forceDirection<span class="token punctuation">;</span>
  <span class="token comment">// Flag to indicate if the conveyor is a simple square/box type without special curved end logic</span>
  <span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">bool</span></span> _squared<span class="token punctuation">;</span>

  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _toggle <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ClassicToggle<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _toggle<span class="token punctuation">.</span>onActivate <span class="token operator">+=</span> ActivateAddOn<span class="token punctuation">;</span>

    <span class="token class-name">TouchStay</span> touchStay <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TouchStay<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    touchStay<span class="token punctuation">.</span>onTouch <span class="token operator">+=</span> OnTouchStayAddOn<span class="token punctuation">;</span>
    touchStay<span class="token punctuation">.</span>onExitTouch <span class="token operator">+=</span> OnTouchExitAddOn<span class="token punctuation">;</span>

    _capsuleColliders2D <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CapsuleCollider2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_capsuleColliders2D<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      _conveyorHalfLength <span class="token operator">=</span> <span class="token punctuation">(</span>_capsuleColliders2D<span class="token punctuation">.</span>size<span class="token punctuation">.</span>x <span class="token operator">-</span> _capsuleColliders2D<span class="token punctuation">.</span>size<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">.5f</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
      _boxCollider2D <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BoxCollider2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      _conveyorHalfLength <span class="token operator">=</span> _boxCollider2D<span class="token punctuation">.</span>size<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token number">.5f</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Determine if the conveyor is horizontal based on Z-rotation</span>
    _isHorizontal <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Approximately</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token number">0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Called when the ClassicToggle is activated/deactivated.</span>
  <span class="token comment">/// Disables the collider when activated, effectively turning off the conveyor's physical interaction.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="activate"&gt;True if the toggle is active (conveyor off), False otherwise (conveyor on).&lt;/param&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ActivateAddOn</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> activate<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Disable the relevant collider if the toggle is active (conveyor is 'off')</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_capsuleColliders2D<span class="token punctuation">)</span> _capsuleColliders2D<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token operator">!</span>activate<span class="token punctuation">;</span>
    <span class="token keyword">else</span> _boxCollider2D<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token operator">!</span>activate<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Called when another Collider2D stays touching the conveyor.</span>
  <span class="token comment">/// Applies force to non-protagonist Rigidbodies and controls protagonist movement.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="touched"&gt;The Collider2D that is touching the conveyor.&lt;/param&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnTouchStayAddOn</span><span class="token punctuation">(</span><span class="token class-name">Collider2D</span> touched<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// If conveyor is off, do nothing</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_toggle<span class="token punctuation">.</span>isActive<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>setting<span class="token punctuation">.</span>protagonist<span class="token punctuation">.</span><span class="token function">IsInLayerMask</span><span class="token punctuation">(</span>touched<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span>layer<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Not protagonist</span>
      <span class="token class-name">Rigidbody2D</span> rb2D <span class="token operator">=</span> touched<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rigidbody2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Apply a simple horizontal velocity.</span>
      rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span><span class="token operator">-</span>_forceDirection<span class="token punctuation">,</span> rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Protagonist</span>
      <span class="token class-name">ProtagonistActor</span> protagonist <span class="token operator">=</span> touched<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ProtagonistActor<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">Vector2</span> positionDifference <span class="token operator">=</span> protagonist<span class="token punctuation">.</span>body<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">-</span> transform<span class="token punctuation">.</span>position<span class="token punctuation">;</span>
      <span class="token class-name">Vector2</span> forceDirection2D <span class="token operator">=</span> Vector2<span class="token punctuation">.</span>zero<span class="token punctuation">;</span>

      protagonist<span class="token punctuation">.</span>frictionLess <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      protagonist<span class="token punctuation">.</span>conveyorTouching <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>_isHorizontal<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// Horizontal conveyor</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_squared <span class="token operator">&amp;&amp;</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>positionDifference<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&gt;</span> _conveyorHalfLength <span class="token operator">&amp;&amp;</span> protagonist<span class="token punctuation">.</span>underPosition<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> transform<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">.45f</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token comment">// Logic for the rounded ends of a capsule-like conveyor (if not squared)</span>

          positionDifference<span class="token punctuation">.</span>x <span class="token operator">+=</span> _conveyorHalfLength <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>positionDifference<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// Calculate force perpendicular to the position difference vector (tangent to the rounded end)</span>
          <span class="token comment">// The force is set to push the protagonist sideways around the end cap</span>
          forceDirection2D <span class="token operator">=</span> Vector2<span class="token punctuation">.</span><span class="token function">Perpendicular</span><span class="token punctuation">(</span>positionDifference<span class="token punctuation">)</span><span class="token punctuation">.</span>normalized <span class="token operator">*</span> _forceDirection<span class="token punctuation">;</span>
          forceDirection2D <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>forceDirection2D<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token number">1.5f</span><span class="token punctuation">,</span> forceDirection2D<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">.6f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Apply multipliers</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>forceDirection2D<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> forceDirection2D<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">GetHorizontalCorrectDirection</span><span class="token punctuation">(</span>positionDifference<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
          <span class="token comment">// Logic for the main, flat part of the conveyor</span>

          forceDirection2D<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">GetHorizontalCorrectDirection</span><span class="token punctuation">(</span>positionDifference<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Adjust protagonist's max speed while moving to account for the conveyor's push/pull</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>protagonist<span class="token punctuation">.</span>isMoving<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>protagonist<span class="token punctuation">.</span>moveDirection<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> protagonist<span class="token punctuation">.</span>maxStatisticActor<span class="token punctuation">.</span>maxSpeed <span class="token operator">=</span> protagonist<span class="token punctuation">.</span>startMaxStatisticActor<span class="token punctuation">.</span>maxSpeed <span class="token operator">+</span> _forceDirection <span class="token operator">*</span> <span class="token number">.7f</span><span class="token punctuation">;</span>
          <span class="token keyword">else</span> protagonist<span class="token punctuation">.</span>maxStatisticActor<span class="token punctuation">.</span>maxSpeed <span class="token operator">=</span> protagonist<span class="token punctuation">.</span>startMaxStatisticActor<span class="token punctuation">.</span>maxSpeed <span class="token operator">-</span> _forceDirection <span class="token operator">*</span> <span class="token number">.7f</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Apply velocity directly if not moving or jumping/using spell</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>protagonist<span class="token punctuation">.</span>isJumping <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>protagonist<span class="token punctuation">.</span>wand<span class="token punctuation">.</span>isUsingSpell<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>protagonist<span class="token punctuation">.</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y <span class="token operator">&gt;=</span> <span class="token number">.1f</span> <span class="token operator">&amp;&amp;</span> forceDirection2D<span class="token punctuation">.</span>y <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            protagonist<span class="token punctuation">.</span>rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>forceDirection2D<span class="token punctuation">.</span>x<span class="token punctuation">,</span> forceDirection2D<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">.5f</span> <span class="token operator">+</span> protagonist<span class="token punctuation">.</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// Vertical conveyor</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>positionDifference<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&gt;</span> _conveyorHalfLength <span class="token operator">&amp;&amp;</span> Math<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>protagonist<span class="token punctuation">.</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> _forceDirection <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>_squared<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token comment">// Logic for the rounded ends of a capsule-like conveyor (if not squared)</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>positionDifference<span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> positionDifference<span class="token punctuation">.</span>y <span class="token operator">+=</span> _conveyorHalfLength<span class="token punctuation">;</span>
          <span class="token keyword">else</span> positionDifference<span class="token punctuation">.</span>y <span class="token operator">-=</span> _conveyorHalfLength<span class="token punctuation">;</span>

          <span class="token comment">// Calculate force perpendicular to the position difference vector (tangent to the rounded end)</span>
          forceDirection2D <span class="token operator">=</span> Vector2<span class="token punctuation">.</span><span class="token function">Perpendicular</span><span class="token punctuation">(</span>positionDifference<span class="token punctuation">)</span><span class="token punctuation">.</span>normalized <span class="token operator">*</span> _forceDirection<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
          <span class="token comment">// Logic for the main, flat part of the conveyor</span>

          <span class="token comment">// Simple vertical force based on X position difference (assuming a vertical conveyor)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>positionDifference<span class="token punctuation">.</span>x <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> forceDirection2D <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2f</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>_forceDirection<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span>_forceDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">else</span> forceDirection2D <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2f</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>_forceDirection<span class="token punctuation">)</span><span class="token punctuation">,</span> _forceDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Apply velocity directly if not moving in the direction of the conveyor's side force, not jumping, not using spell and not recently hurt</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>protagonist<span class="token punctuation">.</span>isMoving <span class="token operator">&amp;&amp;</span> Mathf<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>protagonist<span class="token punctuation">.</span>moveDirection<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> Mathf<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>positionDifference<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>protagonist<span class="token punctuation">.</span>isJumping <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>protagonist<span class="token punctuation">.</span>wand<span class="token punctuation">.</span>isUsingSpell <span class="token operator">&amp;&amp;</span> protagonist<span class="token punctuation">.</span>healthManager<span class="token punctuation">.</span>lastTimeHurt<span class="token punctuation">.</span><span class="token function">IsOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>protagonist<span class="token punctuation">.</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y <span class="token operator">&gt;=</span> <span class="token number">.1f</span> <span class="token operator">&amp;&amp;</span> forceDirection2D<span class="token punctuation">.</span>y <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            protagonist<span class="token punctuation">.</span>rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>forceDirection2D<span class="token punctuation">.</span>x<span class="token punctuation">,</span> forceDirection2D<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">.5f</span> <span class="token operator">+</span> protagonist<span class="token punctuation">.</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// If protagonist on the other side we invert force direction</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;returns&gt;the correct force direction&lt;/returns&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">float</span></span> <span class="token function">GetHorizontalCorrectDirection</span><span class="token punctuation">(</span><span class="token class-name">Vector2</span> positionDifference<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>positionDifference<span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> _forceDirection<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token operator">-</span>_forceDirection<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Called when another Collider2D exits touching the conveyor.</span>
  <span class="token comment">/// Resets protagonist's properties.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="exit"&gt;The Collider2D that is exiting the conveyor.&lt;/param&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnTouchExitAddOn</span><span class="token punctuation">(</span><span class="token class-name">Collider2D</span> exit<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>setting<span class="token punctuation">.</span>protagonist<span class="token punctuation">.</span><span class="token function">IsInLayerMask</span><span class="token punctuation">(</span>exit<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span>layer<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">ProtagonistActor</span> protagonist <span class="token operator">=</span> exit<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ProtagonistActor<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      protagonist<span class="token punctuation">.</span>frictionLess <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      protagonist<span class="token punctuation">.</span>maxStatisticActor<span class="token punctuation">.</span>maxSpeed <span class="token operator">=</span> protagonist<span class="token punctuation">.</span>startMaxStatisticActor<span class="token punctuation">.</span>maxSpeed<span class="token punctuation">;</span>
      protagonist<span class="token punctuation">.</span>conveyorTouching <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code>
</pre>

<h4>Sticky</h4>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Sticky.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<h3 id="Liquids-TheMeltyWay">Liquids</h3>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Liquid-movement.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<ul>
  <li>Wave effect</li>
  <li>Water</li>
  <li>Lava: Deals damage on contact and forces the slime to jump out</li>
  <li>Liquid light: Glows when submerged for a limited time</li>
  <li>Liquid slime: Causes the slime to grow when touching</li>
  <li>Mud: Deadly if the slime remains inside for too long</li>
</ul>

<h4>Different type</h4>

<div class="image-video-container">
  <img src="Images/Contents/TheMeltyWay/All-liquids.jpg" loading="lazy">
</div>
<div class="image-video-container">
  <img src="Images/Contents/TheMeltyWay/Shader-Liquid.jpg" loading="lazy">
</div>

<h4>Wave effect</h4>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Wave-effect.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<pre class="language-csharp" tabindex="0"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LiquidPoint</span>
<span class="token punctuation">{</span>
  <span class="token comment">// Index of this point inside the spline.</span>
  <span class="token class-name"><span class="token keyword">int</span></span> _index<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> index <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _index<span class="token punctuation">;</span> <span class="token keyword">set</span> <span class="token operator">=&gt;</span> _index <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token comment">// Current position of the liquid point in the spline.</span>
  <span class="token class-name">Vector2</span> _position<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">Vector2</span> position <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _position<span class="token punctuation">;</span> <span class="token keyword">set</span> <span class="token operator">=&gt;</span> _position <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token comment">// Original height of the point before any wave deformation.</span>
  <span class="token class-name"><span class="token keyword">float</span></span> _initialHeight<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> initialHeight <span class="token operator">=&gt;</span> _initialHeight<span class="token punctuation">;</span>

  <span class="token comment">// Reference to the liquid point directly to the left (if any).</span>
  <span class="token class-name">LiquidPoint</span> _leftLiquidPoint<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">LiquidPoint</span> leftLiquidPoint <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _leftLiquidPoint<span class="token punctuation">;</span> <span class="token keyword">set</span> <span class="token operator">=&gt;</span> _leftLiquidPoint <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token comment">// Reference to the liquid point directly to the right (if any).</span>
  <span class="token class-name">LiquidPoint</span> _rightLiquidPoint<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">LiquidPoint</span> rightLiquidPoint <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _rightLiquidPoint<span class="token punctuation">;</span> <span class="token keyword">set</span> <span class="token operator">=&gt;</span> _rightLiquidPoint <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token comment">// Spline this point belongs to, used for updating visual positions.</span>
  <span class="token class-name">Spline</span> _liquidSpline<span class="token punctuation">;</span>

  <span class="token comment">// Vertical wave velocity influencing deformation.</span>
  <span class="token class-name"><span class="token keyword">float</span></span> _velocity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> velocity <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _velocity<span class="token punctuation">;</span> <span class="token keyword">set</span> <span class="token operator">=&gt;</span> _velocity <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token comment">// Current wave height produced by sine motion.</span>
  <span class="token class-name"><span class="token keyword">float</span></span> _wave <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">// Wave height from previous update, used to detect direction changes.</span>
  <span class="token class-name"><span class="token keyword">float</span></span> _oldWave <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">// Current step of the sinusoidal wave animation.</span>
  <span class="token class-name"><span class="token keyword">float</span></span> _step <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> step <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _step<span class="token punctuation">;</span> <span class="token keyword">set</span> <span class="token operator">=&gt;</span> _step <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token comment">// Used to offset the sine wave phase for neighbor propagation.</span>
  <span class="token class-name"><span class="token keyword">float</span></span> _stepDisplacement <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> stepDisplacement <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _stepDisplacement<span class="token punctuation">;</span> <span class="token keyword">set</span> <span class="token operator">=&gt;</span> _stepDisplacement <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Creates a new liquid point using a spline index and associates it with the given spline.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="pointIndex"&gt;Index of the point inside the spline.&lt;/param&gt;</span>
  <span class="token comment">/// &lt;param name="liquidSpline"&gt;The spline containing this point.&lt;/param&gt;</span>
  <span class="token keyword">public</span> <span class="token function">LiquidPoint</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> pointIndex<span class="token punctuation">,</span> <span class="token class-name">Spline</span> liquidSpline<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _index <span class="token operator">=</span> pointIndex<span class="token punctuation">;</span>

    _liquidSpline <span class="token operator">=</span> liquidSpline<span class="token punctuation">;</span>

    _position <span class="token operator">=</span> _liquidSpline<span class="token punctuation">.</span><span class="token function">GetPosition</span><span class="token punctuation">(</span>_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _initialHeight <span class="token operator">=</span> _position<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Updates the wave physics using a spring-based sinusoidal model.</span>
  <span class="token comment">/// Also propagates wave energy to left and right neighbors.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="springSwiftness"&gt;Controls wave speed and oscillation frequency.&lt;/param&gt;</span>
  <span class="token comment">/// &lt;param name="maximumExtension"&gt;Maximum allowed deformation above or below initial height.&lt;/param&gt;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">WaveSpringUpdate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">float</span></span> springSwiftness<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> maximumExtension<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// If nearly stopped, reset to initial height.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Matho<span class="token punctuation">.</span><span class="token function">IsBetween</span><span class="token punctuation">(</span>_velocity<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">.05f</span><span class="token punctuation">,</span> <span class="token number">.05f</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_step <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      _liquidSpline<span class="token punctuation">.</span><span class="token function">SetPosition</span><span class="token punctuation">(</span>_index<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>_position<span class="token punctuation">.</span>x<span class="token punctuation">,</span> _initialHeight<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      _step <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    _oldWave <span class="token operator">=</span> _wave<span class="token punctuation">;</span>

    <span class="token comment">// Calculate new wave using sinusoidal animation</span>
    _wave <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>_step <span class="token operator">*</span> Mathf<span class="token punctuation">.</span>PI <span class="token operator">*</span> springSwiftness <span class="token operator">+</span> _stepDisplacement<span class="token punctuation">)</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>_velocity<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Detect wave direction, propagate wave to neighbors</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Mathf<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>_wave<span class="token punctuation">)</span> <span class="token operator">!=</span> Mathf<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>_oldWave<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> _step <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">float</span></span> neightboorVelocity <span class="token operator">=</span> <span class="token operator">-</span>_velocity <span class="token operator">*</span> <span class="token number">.9f</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>Matho<span class="token punctuation">.</span><span class="token function">IsBetween</span><span class="token punctuation">(</span>neightboorVelocity<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">.05f</span><span class="token punctuation">,</span> <span class="token number">.05f</span><span class="token punctuation">)</span><span class="token punctuation">)</span> neightboorVelocity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

      <span class="token function">PropagateWaveToNeighbor</span><span class="token punctuation">(</span>_leftLiquidPoint<span class="token punctuation">,</span> neightboorVelocity<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PropagateWaveToNeighbor</span><span class="token punctuation">(</span>_rightLiquidPoint<span class="token punctuation">,</span> neightboorVelocity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// Slow down wave velocity over time</span>
    _velocity <span class="token operator">*=</span> <span class="token number">.9925f</span><span class="token punctuation">;</span>

    <span class="token comment">// Clamp wave height limits</span>
    _velocity <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Clamp</span><span class="token punctuation">(</span>_velocity<span class="token punctuation">,</span> <span class="token operator">-</span>maximumExtension<span class="token punctuation">,</span> maximumExtension<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Vector2</span> newPosition <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span>_position<span class="token punctuation">.</span>x<span class="token punctuation">,</span> _initialHeight <span class="token operator">+</span> _wave<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _step <span class="token operator">+=</span> <span class="token number">.1f</span><span class="token punctuation">;</span>

    <span class="token comment">// Update spline visually</span>
    _liquidSpline<span class="token punctuation">.</span><span class="token function">SetPosition</span><span class="token punctuation">(</span>_index<span class="token punctuation">,</span> newPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _position <span class="token operator">=</span> newPosition<span class="token punctuation">;</span>

    <span class="token function">Smoothing</span><span class="token punctuation">(</span>maximumExtension<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Attempts to propagate wave velocity to a neighboring LiquidPoint</span>
  <span class="token comment">/// if its current velocity is weaker than this point's velocity.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="neighbor"&gt;The neighboring LiquidPoint (left or right).&lt;/param&gt;</span>
  <span class="token comment">/// &lt;param name="neighborVelocity"&gt;Velocity to transfer to the neighbor.&lt;/param&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PropagateWaveToNeighbor</span><span class="token punctuation">(</span><span class="token class-name">LiquidPoint</span> neighbor<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> neighborVelocity<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>neighbor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>neighbor<span class="token punctuation">.</span>velocity<span class="token punctuation">)</span> <span class="token operator">&lt;</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>velocity<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      neighbor<span class="token punctuation">.</span>velocity <span class="token operator">=</span> neighborVelocity<span class="token punctuation">;</span>
      neighbor<span class="token punctuation">.</span>stepDisplacement <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1f</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>_step <span class="token operator">&lt;</span> neighbor<span class="token punctuation">.</span>step<span class="token punctuation">)</span>
        neighbor<span class="token punctuation">.</span>step <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Adjusts tangent vectors to ensure smooth wave motion between neighboring points.</span>
  <span class="token comment">/// Prevents sharp edges when waves propagate.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="maximumExtension"&gt;Maximum wave amplitude, used to determine tangent behavior.&lt;/param&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Smoothing</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">float</span></span> maximumExtension<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name">Vector2</span> leftTangent <span class="token operator">=</span> <span class="token function">CalculateTangent</span><span class="token punctuation">(</span>Vector2<span class="token punctuation">.</span>left<span class="token punctuation">,</span> _leftLiquidPoint<span class="token punctuation">,</span> maximumExtension<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Vector2</span> rightTangent <span class="token operator">=</span> <span class="token function">CalculateTangent</span><span class="token punctuation">(</span>Vector2<span class="token punctuation">.</span>right<span class="token punctuation">,</span> _rightLiquidPoint<span class="token punctuation">,</span> maximumExtension<span class="token punctuation">)</span><span class="token punctuation">;</span>

    _liquidSpline<span class="token punctuation">.</span><span class="token function">SetLeftTangent</span><span class="token punctuation">(</span>_index<span class="token punctuation">,</span> leftTangent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _liquidSpline<span class="token punctuation">.</span><span class="token function">SetRightTangent</span><span class="token punctuation">(</span>_index<span class="token punctuation">,</span> rightTangent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Calculates the tangent vector for a neighboring point (left or right),</span>
  <span class="token comment">/// based on this point's velocity, wave height, and maximum extension.</span>
  <span class="token comment">/// Returns Vector2.zero when no tangent should be applied.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="direction"&gt;Direction of tangent (Vector2.left or Vector2.right).&lt;/param&gt;</span>
  <span class="token comment">/// &lt;param name="neighbor"&gt;The neighbor to calculate tangent.&lt;/param&gt;</span>
  <span class="token comment">/// &lt;param name="maximumExtension"&gt;Maximum allowed wave extension.&lt;/param&gt;</span>
  <span class="token comment">/// &lt;returns&gt;The calculated tangent vector.&lt;/returns&gt;</span>
  <span class="token return-type class-name">Vector2</span> <span class="token function">CalculateTangent</span><span class="token punctuation">(</span><span class="token class-name">Vector2</span> direction<span class="token punctuation">,</span> <span class="token class-name">LiquidPoint</span> neighbor<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> maximumExtension<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>neighbor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> Vector2<span class="token punctuation">.</span>zero<span class="token punctuation">;</span>

    <span class="token class-name">Vector2</span> tangent <span class="token operator">=</span> direction <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>velocity<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.6f</span><span class="token punctuation">;</span>

    <span class="token comment">// Disable tangent if wave is too tall</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_wave <span class="token operator">&gt;</span> maximumExtension <span class="token operator">*</span> <span class="token number">0.25f</span><span class="token punctuation">)</span>
      tangent <span class="token operator">=</span> Vector2<span class="token punctuation">.</span>zero<span class="token punctuation">;</span>

    <span class="token keyword">return</span> tangent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Liquid</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
  <span class="token comment">// How fast waves move.</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">float</span></span> _springSwiftness<span class="token punctuation">;</span>
  <span class="token comment">// Maximum allowed height or depth of a wave point</span>
  <span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">float</span></span> _maximumExtension<span class="token punctuation">;</span>
  <span class="token comment">// Speed reduction multiplier applied to objects entering the liquid</span>
  <span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">float</span></span> _speedRemoveInLiquid<span class="token punctuation">;</span>
  <span class="token comment">// How much the whole liquid object moves when toggled on</span>
  <span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">float</span></span> _positionDisplaceOnActivate<span class="token punctuation">;</span>
  <span class="token comment">// Time taken for the liquid to move up</span>
  <span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">float</span></span> _timeForLiquidGoingUp<span class="token punctuation">;</span>
  <span class="token comment">// Time taken for the liquid to move down</span>
  <span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">float</span></span> _timeForLiquidGoingDown<span class="token punctuation">;</span>
  <span class="token comment">// Velocity reduction applied to objects when they first enter the liquid</span>
  <span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token keyword">protected</span> <span class="token class-name"><span class="token keyword">float</span></span> _velocityRemovedWhenEnter<span class="token punctuation">;</span>
  <span class="token comment">// Maximum vertical speed when exiting the liquid without moving</span>
  <span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token keyword">protected</span> <span class="token class-name"><span class="token keyword">float</span></span> _velocityCapWhenNaturalExit<span class="token punctuation">;</span>
  <span class="token comment">// Custom gravitational force applied while an object is inside the liquid</span>
  <span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token keyword">protected</span> <span class="token class-name"><span class="token keyword">float</span></span> _liquidGravity<span class="token punctuation">;</span>
  <span class="token comment">// Color of splash particle effects.</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token class-name">Color</span> _particleColor<span class="token punctuation">;</span>

  <span class="token class-name">PolygonCollider2D</span> _polygonCollider2D<span class="token punctuation">;</span>
  <span class="token class-name">SpriteShapeController</span> _spriteShapeController<span class="token punctuation">;</span>
  <span class="token comment">// All liquid lines, each containing multiple wave points.</span>
  <span class="token keyword">protected</span> <span class="token class-name">LiquidPoint<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> _liquidLines<span class="token punctuation">;</span>
  <span class="token class-name">ClassicToggle</span> _toggle<span class="token punctuation">;</span>
  <span class="token comment">// Original position of the liquid before any animation.</span>
  <span class="token class-name">Vector2</span> _basePosition<span class="token punctuation">;</span>
  <span class="token class-name">Coroutine</span> _animation<span class="token punctuation">;</span>

  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _basePosition <span class="token operator">=</span> transform<span class="token punctuation">.</span>position<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_timeForLiquidGoingDown <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> _timeForLiquidGoingDown <span class="token operator">=</span> _timeForLiquidGoingUp<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _toggle <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ClassicToggle<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _toggle<span class="token punctuation">.</span>onActivate <span class="token operator">+=</span> ActivateAddOn<span class="token punctuation">;</span>

    _polygonCollider2D <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>PolygonCollider2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _spriteShapeController <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SpriteShapeController<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Touch event connections, help to get more control on collision</span>
    <span class="token class-name">TouchEnter</span> touchEnter <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TouchEnter<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    touchEnter<span class="token punctuation">.</span>onTouch <span class="token operator">+=</span> OnTouchEnterAddOn<span class="token punctuation">;</span>
    touchEnter<span class="token punctuation">.</span>onExitTouch <span class="token operator">+=</span> OnTouchExitAddOn<span class="token punctuation">;</span>

    <span class="token class-name">Spline</span> liquidSpline <span class="token operator">=</span> _spriteShapeController<span class="token punctuation">.</span>spline<span class="token punctuation">;</span>

    <span class="token class-name">List<span class="token punctuation">&lt;</span>LiquidPoint<span class="token punctuation">&gt;</span></span> leftCornerLiquidPoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>LiquidPoint<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">int</span></span> liquidSplinePointCount <span class="token operator">=</span> liquidSpline<span class="token punctuation">.</span><span class="token function">GetPointCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/// Build left and right liquid points</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> liquidSplinePointCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span></span> leftCornerPointIndex <span class="token operator">=</span> UnityExtension<span class="token punctuation">.</span><span class="token function">ValidateIndex</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> liquidSplinePointCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">int</span></span> rightCornerPointIndex <span class="token operator">=</span> UnityExtension<span class="token punctuation">.</span><span class="token function">ValidateIndex</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> liquidSplinePointCount<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">Vector2</span> pointPosition <span class="token operator">=</span> liquidSpline<span class="token punctuation">.</span><span class="token function">GetPosition</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Vector2</span> leftCornerPointPosition <span class="token operator">=</span> liquidSpline<span class="token punctuation">.</span><span class="token function">GetPosition</span><span class="token punctuation">(</span>leftCornerPointIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Identify top edge points to expand into a wave line</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>pointPosition<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> leftCornerPointPosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token class-name">LiquidPoint</span> liquidPoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LiquidPoint</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> liquidSpline<span class="token punctuation">)</span><span class="token punctuation">;</span>
        liquidPoint<span class="token punctuation">.</span>rightLiquidPoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LiquidPoint</span><span class="token punctuation">(</span>rightCornerPointIndex<span class="token punctuation">,</span> liquidSpline<span class="token punctuation">)</span><span class="token punctuation">;</span>
        leftCornerLiquidPoint<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>liquidPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token class-name"><span class="token keyword">int</span></span> indexOffSet <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// Construct wave lines based on detected top corners</span>
    _liquidLines <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LiquidPoint</span><span class="token punctuation">[</span>leftCornerLiquidPoint<span class="token punctuation">.</span>Count<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> leftCornerLiquidPoint<span class="token punctuation">.</span>Count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span></span> leftCornerPointIndex <span class="token operator">=</span> leftCornerLiquidPoint<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>index <span class="token operator">+</span> indexOffSet<span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">int</span></span> rightCornerPointIndex <span class="token operator">=</span> leftCornerLiquidPoint<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>rightLiquidPoint<span class="token punctuation">.</span>index <span class="token operator">+</span> indexOffSet<span class="token punctuation">;</span>

      <span class="token class-name">Vector2</span> leftCornerPointPosition <span class="token operator">=</span> leftCornerLiquidPoint<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>position<span class="token punctuation">;</span>
      <span class="token class-name">Vector2</span> rightCornerPointPosition <span class="token operator">=</span> leftCornerLiquidPoint<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>rightLiquidPoint<span class="token punctuation">.</span>position<span class="token punctuation">;</span>

      <span class="token class-name"><span class="token keyword">int</span></span> lineLength <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">RoundToInt</span><span class="token punctuation">(</span>Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>leftCornerPointPosition<span class="token punctuation">.</span>x <span class="token operator">-</span> rightCornerPointPosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">LiquidPoint<span class="token punctuation">[</span><span class="token punctuation">]</span></span> liquidPoints <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LiquidPoint</span><span class="token punctuation">[</span>lineLength<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token comment">// Add intermediate spline points between left and right corners</span>
      indexOffSet <span class="token operator">+=</span> lineLength <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>

      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> lineLength <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> ii<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        liquidSpline<span class="token punctuation">.</span><span class="token function">InsertPointAt</span><span class="token punctuation">(</span>rightCornerPointIndex<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span>rightCornerPointPosition<span class="token punctuation">.</span>x <span class="token operator">-</span> ii <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> rightCornerPointPosition<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      liquidSplinePointCount <span class="token operator">=</span> liquidSpline<span class="token punctuation">.</span><span class="token function">GetPointCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name"><span class="token keyword">int</span></span> pointIndex<span class="token punctuation">;</span>

      <span class="token comment">// Initialize wave points</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> lineLength<span class="token punctuation">;</span> ii<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        pointIndex <span class="token operator">=</span> UnityExtension<span class="token punctuation">.</span><span class="token function">ValidateIndex</span><span class="token punctuation">(</span>leftCornerPointIndex <span class="token operator">+</span> ii<span class="token punctuation">,</span> liquidSplinePointCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        liquidPoints<span class="token punctuation">[</span>ii<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LiquidPoint</span><span class="token punctuation">(</span>pointIndex<span class="token punctuation">,</span> liquidSpline<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// Link neighbors for wave simulation</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> lineLength<span class="token punctuation">;</span> ii<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ii <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> liquidPoints<span class="token punctuation">[</span>ii<span class="token punctuation">]</span><span class="token punctuation">.</span>leftLiquidPoint <span class="token operator">=</span> liquidPoints<span class="token punctuation">[</span>ii <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ii <span class="token operator">&lt;</span> lineLength <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> liquidPoints<span class="token punctuation">[</span>ii<span class="token punctuation">]</span><span class="token punctuation">.</span>rightLiquidPoint <span class="token operator">=</span> liquidPoints<span class="token punctuation">[</span>ii <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      _liquidLines<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> liquidPoints<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Set tangent mode and height for all spline points</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> liquidSpline<span class="token punctuation">.</span><span class="token function">GetPointCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      liquidSpline<span class="token punctuation">.</span><span class="token function">SetTangentMode</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> ShapeTangentMode<span class="token punctuation">.</span>Continuous<span class="token punctuation">)</span><span class="token punctuation">;</span>
      liquidSpline<span class="token punctuation">.</span><span class="token function">SetHeight</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Updates wave physics simulation every physics frame.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">FixedUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _liquidLines<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> _liquidLines<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Length<span class="token punctuation">;</span> ii<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        _liquidLines<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ii</span></span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">WaveSpringUpdate</span><span class="token punctuation">(</span>_springSwiftness<span class="token punctuation">,</span> _maximumExtension<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Moves the liquid up or down depending on toggle state.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="activate"&gt;Whether to raise or lower the liquid.&lt;/param&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ActivateAddOn</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> activate<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Instant movement on scene start</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Time<span class="token punctuation">.</span>timeSinceLevelLoad <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>activate<span class="token punctuation">)</span> transform<span class="token punctuation">.</span>position <span class="token operator">=</span> _basePosition <span class="token operator">+</span> Vector2<span class="token punctuation">.</span>up <span class="token operator">*</span> _positionDisplaceOnActivate<span class="token punctuation">;</span>
      <span class="token keyword">else</span> transform<span class="token punctuation">.</span>position <span class="token operator">=</span> _basePosition<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Animated movement if not on scene start</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_animation <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token function">StopCoroutine</span><span class="token punctuation">(</span>_animation<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>activate<span class="token punctuation">)</span>
        _animation <span class="token operator">=</span> <span class="token function">StartCoroutine</span><span class="token punctuation">(</span>AnimationLibrary<span class="token punctuation">.</span><span class="token function">AnimationTranslate</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x<span class="token punctuation">,</span> transform<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">+</span> _positionDisplaceOnActivate<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Timer</span><span class="token punctuation">(</span>_timeForLiquidGoingUp<span class="token punctuation">)</span><span class="token punctuation">,</span> transform<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
        _animation <span class="token operator">=</span> <span class="token function">StartCoroutine</span><span class="token punctuation">(</span>AnimationLibrary<span class="token punctuation">.</span><span class="token function">AnimationTranslate</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x<span class="token punctuation">,</span> transform<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">-</span> _positionDisplaceOnActivate<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Timer</span><span class="token punctuation">(</span>_timeForLiquidGoingDown<span class="token punctuation">)</span><span class="token punctuation">,</span> transform<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Handles splash, slowdown, gravity adjustment and wave creation when an object enters the liquid.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="touched"&gt;The collider entering the liquid.&lt;/param&gt;</span>
  <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnTouchEnterAddOn</span><span class="token punctuation">(</span><span class="token class-name">Collider2D</span> touched<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name">Rigidbody2D</span> rb2D<span class="token punctuation">;</span>

    <span class="token comment">// Protagonist enter</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>setting<span class="token punctuation">.</span>protagonist<span class="token punctuation">.</span><span class="token function">IsInLayerMask</span><span class="token punctuation">(</span>touched<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span>layer<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">ProtagonistActor</span> protagonist <span class="token operator">=</span> touched<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ProtagonistActor<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rb2D <span class="token operator">=</span> protagonist<span class="token punctuation">.</span>rb2D<span class="token punctuation">;</span>

      <span class="token comment">// Ignore if already inside</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>protagonist<span class="token punctuation">.</span>isInLiquid<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

      <span class="token comment">// Apply liquid effects</span>
      protagonist<span class="token punctuation">.</span>speedRemoveInLiquid <span class="token operator">=</span> _speedRemoveInLiquid<span class="token punctuation">;</span>
      protagonist<span class="token punctuation">.</span>isInLiquid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      protagonist<span class="token punctuation">.</span>liquidGravity <span class="token operator">=</span> _liquidGravity<span class="token punctuation">;</span>
      protagonist<span class="token punctuation">.</span>protagonistAnimator<span class="token punctuation">.</span><span class="token function">Move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Trigger splash or gentle floating sound</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>protagonist<span class="token punctuation">.</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> <span class="token number">5</span> <span class="token operator">||</span> protagonist<span class="token punctuation">.</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>magnitude <span class="token operator">&gt;</span> <span class="token number">14</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        protagonist<span class="token punctuation">.</span>sFXManager<span class="token punctuation">.</span><span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token string">"Enter Water"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">TriggerSplashParticles</span><span class="token punctuation">(</span>protagonist<span class="token punctuation">.</span>vFXManager<span class="token punctuation">,</span> <span class="token number">80</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Atan</span><span class="token punctuation">(</span><span class="token number">.1f</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span> protagonist<span class="token punctuation">.</span>sFXManager<span class="token punctuation">.</span><span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token string">"Floating Water"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Slowdown on entry only if he is not using a spell</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>protagonist<span class="token punctuation">.</span>wand<span class="token punctuation">.</span>isUsingSpell<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token function">RemoveVelocityWhenEnter</span><span class="token punctuation">(</span>rb2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Decoration enter</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>setting<span class="token punctuation">.</span>decoration<span class="token punctuation">.</span><span class="token function">IsInLayerMask</span><span class="token punctuation">(</span>touched<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span>layer<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Decoration</span> decoration <span class="token operator">=</span> touched<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Decoration<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      decoration<span class="token punctuation">.</span>isInLiquid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      decoration<span class="token punctuation">.</span>liquidGravity <span class="token operator">=</span> _liquidGravity<span class="token punctuation">;</span>
      rb2D <span class="token operator">=</span> decoration<span class="token punctuation">.</span>rb2D<span class="token punctuation">;</span>

      decoration<span class="token punctuation">.</span><span class="token function">EnterLiquid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">TriggerSplashParticles</span><span class="token punctuation">(</span>decoration<span class="token punctuation">.</span>vFXManager<span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Atan</span><span class="token punctuation">(</span><span class="token number">.1f</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">RemoveVelocityWhenEnter</span><span class="token punctuation">(</span>rb2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Heavy object enter</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Heavy</span> heavy <span class="token operator">=</span> touched<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Heavy<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      heavy<span class="token punctuation">.</span>isInLiquid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      heavy<span class="token punctuation">.</span>liquidGravity <span class="token operator">=</span> _liquidGravity<span class="token punctuation">;</span>
      rb2D <span class="token operator">=</span> heavy<span class="token punctuation">.</span>rb2D<span class="token punctuation">;</span>

      heavy<span class="token punctuation">.</span><span class="token function">EnterLiquid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">TriggerSplashParticles</span><span class="token punctuation">(</span>heavy<span class="token punctuation">.</span>vFXManager<span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Atan</span><span class="token punctuation">(</span><span class="token number">.1f</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">RemoveVelocityWhenEnter</span><span class="token punctuation">(</span>rb2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">CreateWave</span><span class="token punctuation">(</span>touched<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Handles exit effects such as splash, speed adjustment and wave creation</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="touched"&gt;Object exiting the liquid.&lt;/param&gt;</span>
  <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnTouchExitAddOn</span><span class="token punctuation">(</span><span class="token class-name">Collider2D</span> touched<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name">Rigidbody2D</span> rb2D<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>setting<span class="token punctuation">.</span>protagonist<span class="token punctuation">.</span><span class="token function">IsInLayerMask</span><span class="token punctuation">(</span>touched<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span>layer<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">ProtagonistActor</span> protagonist <span class="token operator">=</span> touched<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ProtagonistActor<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rb2D <span class="token operator">=</span> protagonist<span class="token punctuation">.</span>rb2D<span class="token punctuation">;</span>

      <span class="token comment">// Make sure the exit is real (not still inside bounds)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_polygonCollider2D<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>protagonist<span class="token punctuation">.</span>body<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

      protagonist<span class="token punctuation">.</span>isInLiquid <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      protagonist<span class="token punctuation">.</span>protagonistAnimator<span class="token punctuation">.</span><span class="token function">VelocityAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Splash effect based on exit speed</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>protagonist<span class="token punctuation">.</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> <span class="token number">5</span> <span class="token operator">||</span> protagonist<span class="token punctuation">.</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>magnitude <span class="token operator">&gt;</span> <span class="token number">14</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        protagonist<span class="token punctuation">.</span>sFXManager<span class="token punctuation">.</span><span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token string">"Exit Water"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">TriggerSplashParticles</span><span class="token punctuation">(</span>protagonist<span class="token punctuation">.</span>vFXManager<span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Atan</span><span class="token punctuation">(</span><span class="token number">.1f</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// Natural exit velocity cap so it doesn't jump around on the surface and stay close to still</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>protagonist<span class="token punctuation">.</span>isJumping <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>protagonist<span class="token punctuation">.</span>wand<span class="token punctuation">.</span>isUsingSpell <span class="token operator">&amp;&amp;</span> protagonist<span class="token punctuation">.</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x<span class="token punctuation">,</span> Matho<span class="token punctuation">.</span><span class="token function">Clamp</span><span class="token punctuation">(</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> _velocityCapWhenNaturalExit<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>setting<span class="token punctuation">.</span>decoration<span class="token punctuation">.</span><span class="token function">IsInLayerMask</span><span class="token punctuation">(</span>touched<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span>layer<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Decoration</span> decoration <span class="token operator">=</span> touched<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Decoration<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      decoration<span class="token punctuation">.</span>isInLiquid <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      rb2D <span class="token operator">=</span> decoration<span class="token punctuation">.</span>rb2D<span class="token punctuation">;</span>
      decoration<span class="token punctuation">.</span><span class="token function">ExitLiquid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">TriggerSplashParticles</span><span class="token punctuation">(</span>decoration<span class="token punctuation">.</span>vFXManager<span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Atan</span><span class="token punctuation">(</span><span class="token number">.1f</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
      rb2D <span class="token operator">=</span> touched<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rigidbody2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Wave and upward push to make it look prettier</span>
    <span class="token function">CreateWave</span><span class="token punctuation">(</span>touched<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x<span class="token punctuation">,</span> rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">4f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Creates a vertical wave disturbance near the given world position.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="position"&gt;Position where the disturbance occurs.&lt;/param&gt;</span>
  <span class="token comment">/// &lt;param name="speed"&gt;Speed of the entering/exiting object.&lt;/param&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CreateWave</span><span class="token punctuation">(</span><span class="token class-name">Vector2</span> position<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> speed<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _liquidLines<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> _liquidLines<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Length<span class="token punctuation">;</span> ii<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">+</span> _liquidLines<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ii</span></span><span class="token punctuation">]</span><span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">-</span> position<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">.6f</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          _liquidLines<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ii</span></span><span class="token punctuation">]</span><span class="token punctuation">.</span>velocity <span class="token operator">+=</span> speed <span class="token operator">*</span> <span class="token number">.03f</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Applies splash particle colors and emission rate.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="vfxManager"&gt;The VFX manager containing particles.&lt;/param&gt;</span>
  <span class="token comment">/// &lt;param name="velocity"&gt;Vertical speed influencing splash intensity.&lt;/param&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TriggerSplashParticles</span><span class="token punctuation">(</span><span class="token class-name">VFXManager</span> vfxManager<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> rateOverTime<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vfxManager <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token class-name">ParticleSystem</span> waterSplash <span class="token operator">=</span> vfxManager<span class="token punctuation">.</span>particles<span class="token punctuation">[</span><span class="token string">"WaterSplashParticles"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">ParticleSystem</span> particleChild <span class="token keyword">in</span> waterSplash<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponentsInChildren</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ParticleSystem<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">ParticleSystem<span class="token punctuation">.</span>MainModule</span> main <span class="token operator">=</span> particleChild<span class="token punctuation">.</span>main<span class="token punctuation">;</span>
      main<span class="token punctuation">.</span>startColor <span class="token operator">=</span> _particleColor<span class="token punctuation">;</span>

      <span class="token class-name">ParticleSystem<span class="token punctuation">.</span>EmissionModule</span> emission <span class="token operator">=</span> particleChild<span class="token punctuation">.</span>emission<span class="token punctuation">;</span>
      emission<span class="token punctuation">.</span>rateOverTime <span class="token operator">=</span> rateOverTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    vfxManager<span class="token punctuation">.</span><span class="token function">StartParticle</span><span class="token punctuation">(</span>waterSplash<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Reduces the velocity of an object when it enters the liquid,</span>
  <span class="token comment">/// applying different multipliers to the horizontal and vertical components.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="rb2D"&gt;The Rigidbody2D of the object entering the liquid.&lt;/param&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RemoveVelocityWhenEnter</span><span class="token punctuation">(</span><span class="token class-name">Rigidbody2D</span> rb2D<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    rb2D<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>
        rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token punctuation">(</span>_velocityRemovedWhenEnter <span class="token operator">-</span> <span class="token number">.1f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rb2D<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token punctuation">(</span>_velocityRemovedWhenEnter <span class="token operator">+</span> <span class="token number">.1f</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code>
</pre>

<h3 id="Tools-TheMeltyWay">Tools</h3>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Tools-editor.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<ul>
  <li>Toggle tools to link every toggleable element</li>
  <li>Touch tools for improved collision control</li>
  <li>Use of Unity Tilemap</li>
  <li>Use of Autotiling to facilitate placement</li>
  <li>Automasker for level splatters</li>
  <li>Use of sprite atlas for better performance</li>
  <li>Custom SFX tool</li>
  <li>Save and load system</li>
  <li>Use of the profiler to optimize the game</li>
  <li>Easy modification of values for interactable objects</li>
  <li>Use of Cinemachine for a smooth, confined camera</li>
  <li>Use of Unity's latest Input System package</li>
</ul>


<h4>Toggle</h4>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Toggle.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<pre class="language-csharp" tabindex="0"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassicToggle</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
  <span class="token comment">// Does the object is active?</span>
  <span class="token keyword">protected</span> <span class="token class-name"><span class="token keyword">bool</span></span> _isActive <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> isActive <span class="token operator">=&gt;</span> _isActive<span class="token punctuation">;</span>
  <span class="token comment">// Does the object was active?</span>
  <span class="token keyword">protected</span> <span class="token class-name"><span class="token keyword">bool</span></span> _wasActive<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> wasActive <span class="token operator">=&gt;</span> _wasActive<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> onActivate<span class="token punctuation">;</span>
  <span class="token comment">// Invert the active/deactivate</span>
  <span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token keyword">protected</span> <span class="token class-name"><span class="token keyword">bool</span></span> _inverted<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> inverted <span class="token operator">=&gt;</span> _inverted<span class="token punctuation">;</span>
  <span class="token comment">// Object to activate when this one is activated</span>
  <span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token keyword">protected</span> <span class="token class-name">ClassicToggle<span class="token punctuation">[</span><span class="token punctuation">]</span></span> _interractablesAffected<span class="token punctuation">;</span>
  <span class="token comment">// Gem inital light intensity</span>
  <span class="token keyword">protected</span> <span class="token class-name"><span class="token keyword">float</span></span> _initialGemLightIntensity<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> initialGemLightIntensity <span class="token operator">=&gt;</span> _initialGemLightIntensity<span class="token punctuation">;</span>
  <span class="token comment">// The color assigned to the gem and its light.</span>
  <span class="token keyword">protected</span> <span class="token class-name">Color</span> _gemColor<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">Color</span> gemColor <span class="token operator">=&gt;</span> _gemColor<span class="token punctuation">;</span>
  <span class="token comment">// The SpriteRenderer component for the visual gem element.</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token keyword">protected</span> <span class="token class-name">SpriteRenderer</span> _gem<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">SpriteRenderer</span> gem <span class="token operator">=&gt;</span> _gem<span class="token punctuation">;</span>
  <span class="token comment">// The Light2D component associated with the gem for visual effects.</span>
  <span class="token keyword">protected</span> <span class="token class-name">Light2D</span> _gemLight<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">Light2D</span> gemLight <span class="token operator">=&gt;</span> _gemLight<span class="token punctuation">;</span>

  <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_gem <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> _gemLight <span class="token operator">=</span> _gem<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponentInChildren</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Light2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">Activate</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Color</span> gemColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>black<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_interractablesAffected<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Check if there is a _interractablesAffected that doesn't have a default color</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">ClassicToggle</span> interractableAffected <span class="token keyword">in</span> _interractablesAffected<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>interractableAffected<span class="token punctuation">.</span>gem <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>interractableAffected<span class="token punctuation">.</span>gem<span class="token punctuation">.</span>color <span class="token operator">!=</span> Color<span class="token punctuation">.</span>black<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          gemColor <span class="token operator">=</span> interractableAffected<span class="token punctuation">.</span>gem<span class="token punctuation">.</span>color<span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// If there is no color set by other toggle we get a new one and set ourself to this color</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>gemColor <span class="token operator">==</span> Color<span class="token punctuation">.</span>black<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        gemColor <span class="token operator">=</span> GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>colorOfGems<span class="token punctuation">[</span>UnityEngine<span class="token punctuation">.</span>Random<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>colorOfGems<span class="token punctuation">.</span>Count<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>colorOfGems<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>gemColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      _gem<span class="token punctuation">.</span>color <span class="token operator">=</span> gemColor<span class="token punctuation">;</span>
      _gemLight<span class="token punctuation">.</span>color <span class="token operator">=</span> gemColor<span class="token punctuation">;</span>

      <span class="token comment">// We change the gem color of all the _interractablesAffected</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">ClassicToggle</span> interractableAffected <span class="token keyword">in</span> _interractablesAffected<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>interractableAffected<span class="token punctuation">.</span>gem <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        interractableAffected<span class="token punctuation">.</span>gem<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        interractableAffected<span class="token punctuation">.</span>gem<span class="token punctuation">.</span>color <span class="token operator">=</span> gemColor<span class="token punctuation">;</span>
        interractableAffected<span class="token punctuation">.</span>gem<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponentInChildren</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Light2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>color <span class="token operator">=</span> gemColor<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_gem <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_gem<span class="token punctuation">.</span>color <span class="token operator">==</span> Color<span class="token punctuation">.</span>black<span class="token punctuation">)</span> _gem<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Sets the active state of the toggle, applying inversion, animations, and chaining effects.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="activate"&gt;The desired active state (true for on, false for off).&lt;/param&gt;</span>
  <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Activate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> activate<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_inverted<span class="token punctuation">)</span> activate <span class="token operator">=</span> <span class="token operator">!</span>activate<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_isActive <span class="token operator">==</span> activate<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_gem <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_inverted<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>activate<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token function">AnimateDeactivationVisuals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>activate<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token function">AnimateDeactivationVisuals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    _isActive <span class="token operator">=</span> activate<span class="token punctuation">;</span>
    <span class="token function">OnActivateInvoke</span><span class="token punctuation">(</span>_isActive<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ActivateInterractablesAffected</span><span class="token punctuation">(</span>_isActive<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _wasActive <span class="token operator">=</span> isActive<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Starts the visual animation routines for 'deactivating' the gem</span>
  <span class="token comment">/// This function centralizes the animation calls.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AnimateDeactivationVisuals</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name">Color</span> gemColor <span class="token operator">=</span> _gem<span class="token punctuation">.</span>color<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">float</span></span> initialGemLightIntensity <span class="token operator">=</span> _gemLight<span class="token punctuation">.</span>intensity<span class="token punctuation">;</span>

    <span class="token function">StartCoroutine</span><span class="token punctuation">(</span>AnimationLibrary<span class="token punctuation">.</span><span class="token function">AnimationIntensityLight</span><span class="token punctuation">(</span>_gemLight<span class="token punctuation">.</span>intensity<span class="token punctuation">,</span> initialGemLightIntensity <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">.1f</span><span class="token punctuation">,</span> _gemLight<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">StartCoroutine</span><span class="token punctuation">(</span>AnimationLibrary<span class="token punctuation">.</span><span class="token function">AnimationChangeColor</span><span class="token punctuation">(</span>gemColor<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Color</span><span class="token punctuation">(</span><span class="token number">.25f</span><span class="token punctuation">,</span> <span class="token number">.25f</span><span class="token punctuation">,</span> <span class="token number">.25f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">.1f</span><span class="token punctuation">,</span> _gem<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Safely invokes the onActivate event with the new state.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="isActive"&gt;The current active state.&lt;/param&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnActivateInvoke</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> isActive<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    onActivate<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>isActive<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Calls the Activate method on all associated toggles in the _interractablesAffected array.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="activate"&gt;The activation state to pass to the affected toggles.&lt;/param&gt;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ActivateInterractablesAffected</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> activate<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_interractablesAffected<span class="token punctuation">.</span>Length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">ClassicToggle</span> interractableAffected <span class="token keyword">in</span> _interractablesAffected<span class="token punctuation">)</span> interractableAffected<span class="token punctuation">.</span><span class="token function">Activate</span><span class="token punctuation">(</span>activate<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TimedToggle</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ClassicToggle</span></span>
<span class="token punctuation">{</span>
  <span class="token comment">// The duration (in seconds) that the toggle will remain active after activation.</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Range</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">.3f</span><span class="token punctuation">,</span> <span class="token number">100f</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">float</span></span> _stayActivatedTime<span class="token punctuation">;</span>
  <span class="token comment">// Timer instance used to track the remaining active time.</span>
  <span class="token class-name">Timer</span> _activateTimer<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">Timer</span> activateTimer <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _activateTimer<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token comment">// Coroutine reference for the flashing sequence that runs when the slime is on it</span>
  <span class="token class-name">Coroutine</span> _flashGemWait <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token comment">// Coroutine reference for the flashing sequence that runs during the main cooldown</span>
  <span class="token class-name">Coroutine</span> _flashGemCooldownLeft <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token comment">// Reference to the SFXManager to play sound effects associated with the timer.</span>
  <span class="token class-name">SFXManager</span> _sFXManager<span class="token punctuation">;</span>

  <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _activateTimer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Timer</span><span class="token punctuation">(</span>_stayActivatedTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _sFXManager <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SFXManager<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_gem <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      _initialGemLightIntensity <span class="token operator">=</span> _gemLight<span class="token punctuation">.</span>intensity<span class="token punctuation">;</span>
      _gemColor <span class="token operator">=</span> _gem<span class="token punctuation">.</span>color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Overrides the base Activate method to handle timer restart and visual feedback.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="activate"&gt;The desired activation state.&lt;/param&gt;</span>
  <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Activate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> activate<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>activate<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// If activating and the toggle wasn't previously active (to prevent starting the flash animation mid-cycle),</span>
      <span class="token comment">// start the main FlashGem coroutine.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_wasActive <span class="token operator">&amp;&amp;</span> _gem <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token function">FlashGem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      _activateTimer<span class="token punctuation">.</span><span class="token function">Restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Activate</span><span class="token punctuation">(</span>activate<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Main coroutine that monitors the timer and switches between the two flashing routines.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token return-type class-name">IEnumerator</span> <span class="token function">FlashGem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>_isActive<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Check if the time passed is short (the slime is still on the pressure plate)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_activateTimer<span class="token punctuation">.</span><span class="token function">TimePass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0.2f</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_flashGemWait <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> _flashGemWait <span class="token operator">=</span> <span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token function">FlashGemWait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_flashGemCooldownLeft <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> _flashGemCooldownLeft <span class="token operator">=</span> <span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token function">FlashGemCooldownLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Flashing when the slime is standing on the pressure plate</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token return-type class-name">IEnumerator</span> <span class="token function">FlashGemWait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">bool</span></span> activate <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>_isActive<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">SFX</span> sFX <span class="token operator">=</span> _sFXManager<span class="token punctuation">.</span>sFXs<span class="token punctuation">[</span><span class="token string">"GemFlash"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      sFX<span class="token punctuation">.</span>audioSource<span class="token punctuation">.</span>pitch <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> _activateTimer<span class="token punctuation">.</span><span class="token function">PercentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">.5f</span><span class="token punctuation">;</span>
      _sFXManager<span class="token punctuation">.</span><span class="token function">PlaySound</span><span class="token punctuation">(</span>sFX<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// If the other coroutine is running cancel it</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_flashGemCooldownLeft <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token function">StopCoroutine</span><span class="token punctuation">(</span>_flashGemCooldownLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _flashGemCooldownLeft <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">ChangeAllGem</span><span class="token punctuation">(</span>activate<span class="token punctuation">,</span> <span class="token number">.1f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WaitForSeconds</span><span class="token punctuation">(</span><span class="token number">.1f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      activate <span class="token operator">=</span> <span class="token operator">!</span>activate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Flashing coroutine for the main cooldown period. The flash speed and duration</span>
  <span class="token comment">/// dynamically adjust based on the percentage of time remaining.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token return-type class-name">IEnumerator</span> <span class="token function">FlashGemCooldownLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">float</span></span> timeAnimation<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">float</span></span> timeAnimationOn<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">float</span></span> timeAnimationOff<span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">float</span></span> timeLeft <span class="token operator">=</span> _activateTimer<span class="token punctuation">.</span><span class="token function">TimeLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">float</span></span> timeAddedUp <span class="token operator">=</span> _activateTimer<span class="token punctuation">.</span><span class="token function">TimePass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>_isActive<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token class-name">SFX</span> sFX <span class="token operator">=</span> _sFXManager<span class="token punctuation">.</span>sFXs<span class="token punctuation">[</span><span class="token string">"GemFlash"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      sFX<span class="token punctuation">.</span>audioSource<span class="token punctuation">.</span>pitch <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> _activateTimer<span class="token punctuation">.</span><span class="token function">PercentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">.5f</span><span class="token punctuation">;</span>
      _sFXManager<span class="token punctuation">.</span><span class="token function">PlaySound</span><span class="token punctuation">(</span>sFX<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// If the other coroutine is running cancel it</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_flashGemWait <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token function">StopCoroutine</span><span class="token punctuation">(</span>_flashGemWait<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _flashGemWait <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// Calculate base animation durations, scaled by the time percentage remaining.</span>
      timeAnimationOff <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>_activateTimer<span class="token punctuation">.</span><span class="token function">PercentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> _activateTimer<span class="token punctuation">.</span>duration <span class="token operator">*</span> <span class="token number">.25f</span><span class="token punctuation">;</span>
      timeAnimationOn <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>_activateTimer<span class="token punctuation">.</span><span class="token function">PercentTime</span><span class="token punctuation">(</span>timeAnimationOff<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> _activateTimer<span class="token punctuation">.</span>duration <span class="token operator">*</span> <span class="token number">.25f</span><span class="token punctuation">;</span>
      timeAnimation <span class="token operator">=</span> timeAnimationOff <span class="token operator">+</span> timeAnimationOn<span class="token punctuation">;</span>

      <span class="token comment">// If the calculated animation time plus a buffer (0.15f) exceeds the time left,</span>
      <span class="token comment">// recalculate the animation timings to finish exactly when the timer runs out.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>timeAddedUp <span class="token operator">+</span> timeAnimation <span class="token operator">+</span> _activateTimer<span class="token punctuation">.</span>duration <span class="token operator">*</span> <span class="token number">.15f</span> <span class="token operator">&gt;</span> timeLeft<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        timeAnimation <span class="token operator">=</span> timeLeft <span class="token operator">-</span> timeAddedUp<span class="token punctuation">;</span>
        timeAnimationOff <span class="token operator">=</span> timeAnimation <span class="token operator">*</span> <span class="token number">.4f</span><span class="token punctuation">;</span>
        timeAnimationOn <span class="token operator">=</span> timeAnimation <span class="token operator">*</span> <span class="token number">.6f</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      timeAddedUp <span class="token operator">+=</span> timeAnimation<span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>timeAnimation <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// Animate flash off</span>
        <span class="token function">ChangeAllGem</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> timeAnimationOff<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WaitForSeconds</span><span class="token punctuation">(</span>timeAnimationOff<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>timeAnimation <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// Animate flash on</span>
        <span class="token function">ChangeAllGem</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> timeAnimationOn<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WaitForSeconds</span><span class="token punctuation">(</span>timeAnimationOn<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Applies gem flash changes to this gem and all linked interactables.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ChangeAllGem</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> active<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> duration<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Update main gem</span>
    <span class="token function">ChangeGem</span><span class="token punctuation">(</span>active<span class="token punctuation">,</span> duration<span class="token punctuation">,</span> _gem<span class="token punctuation">,</span> _gemLight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_interractablesAffected<span class="token punctuation">.</span>Length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Affect all of the _interractablesAffected as well</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">ClassicToggle</span> interractableAffected <span class="token keyword">in</span> _interractablesAffected<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>interractableAffected<span class="token punctuation">.</span>gem <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token function">ChangeGem</span><span class="token punctuation">(</span>active<span class="token punctuation">,</span> duration<span class="token punctuation">,</span> interractableAffected<span class="token punctuation">.</span>gem<span class="token punctuation">,</span> interractableAffected<span class="token punctuation">.</span>gemLight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Animates gem color and light intensity based on flash state.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ChangeGem</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> active<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> duration<span class="token punctuation">,</span> <span class="token class-name">SpriteRenderer</span> gem<span class="token punctuation">,</span> <span class="token class-name">Light2D</span> gemLight<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>active<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Animate intensifying light and returning to original color</span>
      <span class="token function">StartCoroutine</span><span class="token punctuation">(</span>AnimationLibrary<span class="token punctuation">.</span><span class="token function">AnimationIntensityLight</span><span class="token punctuation">(</span>_gemLight<span class="token punctuation">.</span>intensity<span class="token punctuation">,</span> _initialGemLightIntensity<span class="token punctuation">,</span> duration<span class="token punctuation">,</span> gemLight<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">StartCoroutine</span><span class="token punctuation">(</span>AnimationLibrary<span class="token punctuation">.</span><span class="token function">AnimationChangeColor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Color</span><span class="token punctuation">(</span><span class="token number">.25f</span><span class="token punctuation">,</span> <span class="token number">.25f</span><span class="token punctuation">,</span> <span class="token number">.25f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> _gemColor<span class="token punctuation">,</span> duration<span class="token punctuation">,</span> gem<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Animate dimming light and darkening gem</span>
      <span class="token function">StartCoroutine</span><span class="token punctuation">(</span>AnimationLibrary<span class="token punctuation">.</span><span class="token function">AnimationIntensityLight</span><span class="token punctuation">(</span>_gemLight<span class="token punctuation">.</span>intensity<span class="token punctuation">,</span> _initialGemLightIntensity <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">,</span> duration<span class="token punctuation">,</span> gemLight<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">StartCoroutine</span><span class="token punctuation">(</span>AnimationLibrary<span class="token punctuation">.</span><span class="token function">AnimationChangeColor</span><span class="token punctuation">(</span>_gemColor<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Color</span><span class="token punctuation">(</span><span class="token number">.25f</span><span class="token punctuation">,</span> <span class="token number">.25f</span><span class="token punctuation">,</span> <span class="token number">.25f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> duration<span class="token punctuation">,</span> gem<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Checks the timer to ensure deactivation.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">FixedUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_isActive<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_activateTimer<span class="token punctuation">.</span><span class="token function">IsOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">Activate</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code>
</pre>

<h4>Touch</h4>

<pre class="language-csharp" tabindex="0"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Touch</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
  <span class="token comment">// Event invoked when a relevant Collider2D enters or stays within the trigger area.</span>
  <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span>Collider2D<span class="token punctuation">&gt;</span></span> onTouch<span class="token punctuation">;</span>
  <span class="token comment">// Event invoked when a relevant Collider2D exits the trigger area.</span>
  <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span>Collider2D<span class="token punctuation">&gt;</span></span> onExitTouch<span class="token punctuation">;</span>
  <span class="token comment">// Specifies which Unity physics layers are allowed to trigger the onTouch event.</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token keyword">protected</span> <span class="token class-name">LayerMask</span> _layerMaskToTouch<span class="token punctuation">;</span>
  <span class="token comment">// Specifies which Unity physics layers should be explicitly ignored by the trigger logic.</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token keyword">protected</span> <span class="token class-name">LayerMask</span> _layerMaskToIgnore<span class="token punctuation">;</span>
  <span class="token comment">// A Timer to enforce a minimum time interval between successful touch events.</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token keyword">protected</span> <span class="token class-name">Timer</span> _timerBetweenTouch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Timer</span><span class="token punctuation">(</span><span class="token number">.1f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnTouchInvoke</span><span class="token punctuation">(</span><span class="token class-name">Collider2D</span> touched<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    onTouch<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>touched<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnExitTouchInvoke</span><span class="token punctuation">(</span><span class="token class-name">Collider2D</span> touched<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    onExitTouch<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>touched<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Handles the physics collision/trigger exit event.</span>
  <span class="token comment">/// Filters exits based on LayerMasks and invokes the exit event.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="touched"&gt;The Collider2D that exited the trigger.&lt;/param&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnTouchExit2D</span><span class="token punctuation">(</span><span class="token class-name">Collider2D</span> touched<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_layerMaskToIgnore<span class="token punctuation">.</span><span class="token function">IsInLayerMask</span><span class="token punctuation">(</span>touched<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span>layer<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>_layerMaskToTouch<span class="token punctuation">.</span><span class="token function">IsInLayerMask</span><span class="token punctuation">(</span>touched<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span>layer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token function">OnExitTouchInvoke</span><span class="token punctuation">(</span>touched<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// If the object is in the object to ignore then we ignore collision in the future</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="touched"&gt; The Collider2D that entered the trigger.&lt;/param&gt;</span>
  <span class="token comment">/// &lt;returns&gt;if we can or not touch&lt;/returns&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">CanTouch</span><span class="token punctuation">(</span><span class="token class-name">Collider2D</span> touched<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_layerMaskToIgnore<span class="token punctuation">.</span><span class="token function">IsInLayerMask</span><span class="token punctuation">(</span>touched<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span>layer<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Physics2D<span class="token punctuation">.</span><span class="token function">IgnoreCollision</span><span class="token punctuation">(</span>touched<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Collider2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Collider2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_layerMaskToTouch<span class="token punctuation">.</span><span class="token function">IsInLayerMask</span><span class="token punctuation">(</span>touched<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span>layer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">TouchEnter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Touch</span></span>
<span class="token punctuation">{</span>
  <span class="token comment">// Stores the last GameObject that successfully triggered a touch event. Used for the cooldown/debounce logic.</span>
  <span class="token class-name">GameObject</span> _lastTouched<span class="token punctuation">;</span>
  <span class="token comment">// the number of time this object can be touch before getting deactivate</span>
  <span class="token punctuation">[</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">int</span></span> _numberTouchBeforeDeactivate<span class="token punctuation">;</span>
  <span class="token comment">// the number of time this object can be touch before getting deactivate at start</span>
  <span class="token class-name"><span class="token keyword">int</span></span> _numberTouchBeforeDeactivateStart<span class="token punctuation">;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _numberTouchBeforeDeactivateStart <span class="token operator">=</span> _numberTouchBeforeDeactivate<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Handles the physics collision/trigger event</span>
  <span class="token comment">/// Filters collisions based on LayerMasks, applies cooldown and processes the touch limit.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="touched"&gt;The Collider2D that entered the trigger.&lt;/param&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnTouchEnter2D</span><span class="token punctuation">(</span><span class="token class-name">Collider2D</span> touched<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CanTouch</span><span class="token punctuation">(</span>touched<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_timerBetweenTouch<span class="token punctuation">.</span><span class="token function">IsOverLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> _lastTouched <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">// If the same hit in a row we ignore</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_lastTouched <span class="token operator">==</span> touched<span class="token punctuation">.</span>gameObject<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    _lastTouched <span class="token operator">=</span> touched<span class="token punctuation">.</span>gameObject<span class="token punctuation">;</span>

    <span class="token function">OnTouchInvoke</span><span class="token punctuation">(</span>touched<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_numberTouchBeforeDeactivate <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      _numberTouchBeforeDeactivate<span class="token operator">--</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_numberTouchBeforeDeactivate <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// Add back the amount of touch before deactivate in case we want to reuse the object</span>
        _numberTouchBeforeDeactivate <span class="token operator">=</span> _numberTouchBeforeDeactivateStart<span class="token punctuation">;</span>
        gameObject<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">TouchStay</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Touch</span></span>
<span class="token punctuation">{</span>
  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Handles the continuous physics collision/trigger event</span>
  <span class="token comment">/// Filters the collision based on LayerMasks and enforces a cooldown period.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token comment">/// &lt;param name="touched"&gt;The Collider2D that is staying within the trigger.&lt;/param&gt;</span>
  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnTouchStay2D</span><span class="token punctuation">(</span><span class="token class-name">Collider2D</span> touched<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CanTouch</span><span class="token punctuation">(</span>touched<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_timerBetweenTouch<span class="token punctuation">.</span><span class="token function">IsOverLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token function">OnTouchInvoke</span><span class="token punctuation">(</span>touched<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TouchCollisionEnter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">TouchEnter</span></span>
<span class="token punctuation">{</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnCollisionEnter2D</span><span class="token punctuation">(</span><span class="token class-name">Collision2D</span> touched<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">OnTouchEnter2D</span><span class="token punctuation">(</span>touched<span class="token punctuation">.</span>collider<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnCollisionExit2D</span><span class="token punctuation">(</span><span class="token class-name">Collision2D</span> exit<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">OnTouchExit2D</span><span class="token punctuation">(</span>exit<span class="token punctuation">.</span>collider<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TouchCollisionStay</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">TouchStay</span></span>
<span class="token punctuation">{</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnCollisionStay2D</span><span class="token punctuation">(</span><span class="token class-name">Collision2D</span> touched<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">OnTouchStay2D</span><span class="token punctuation">(</span>touched<span class="token punctuation">.</span>collider<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnCollisionExit2D</span><span class="token punctuation">(</span><span class="token class-name">Collision2D</span> exit<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">OnTouchExit2D</span><span class="token punctuation">(</span>exit<span class="token punctuation">.</span>collider<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TouchTriggerEnter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">TouchEnter</span></span>
<span class="token punctuation">{</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnTriggerEnter2D</span><span class="token punctuation">(</span><span class="token class-name">Collider2D</span> touched<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">OnTouchEnter2D</span><span class="token punctuation">(</span>touched<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnTriggerExit2D</span><span class="token punctuation">(</span><span class="token class-name">Collider2D</span> exit<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">OnTouchExit2D</span><span class="token punctuation">(</span>exit<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TouchTriggerStay</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">TouchStay</span></span>
<span class="token punctuation">{</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnTriggerStay2D</span><span class="token punctuation">(</span><span class="token class-name">Collider2D</span> touched<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">OnTouchStay2D</span><span class="token punctuation">(</span>touched<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnTriggerExit2D</span><span class="token punctuation">(</span><span class="token class-name">Collider2D</span> exit<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">OnTouchExit2D</span><span class="token punctuation">(</span>exit<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code>
</pre>

<h4>Save and load</h4>

<pre class="language-csharp" tabindex="0"><code class="language-csharp"><span class="token punctuation">[</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">]</span>

<span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// Save progress of the game</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token comment">/// &lt;param name="levelManager"&gt;The level manager to use for saving.&lt;/param&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SaveProgress</span><span class="token punctuation">(</span><span class="token class-name">LevelManager</span> levelManager<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name">LevelData</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LevelData</span><span class="token punctuation">(</span>GameManager<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>protagonistColor<span class="token punctuation">,</span>
                                levelManager<span class="token punctuation">.</span>dyeCollected<span class="token punctuation">,</span>
                                levelManager<span class="token punctuation">.</span>level<span class="token punctuation">,</span>
                                levelManager<span class="token punctuation">.</span>floor<span class="token punctuation">,</span>
                                levelManager<span class="token punctuation">.</span>highestFloor<span class="token punctuation">,</span>
                                levelManager<span class="token punctuation">.</span>nextFloorUnlocked<span class="token punctuation">,</span>
                                levelManager<span class="token punctuation">.</span>levelAnimationPlayed<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">Save</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// Reset the game progress</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token comment">/// &lt;param name="levelManager"&gt;The level manager to use for reseting progress.&lt;/param&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ResetProgress</span><span class="token punctuation">(</span><span class="token class-name">LevelManager</span> levelManager<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name">LevelData</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LevelData</span><span class="token punctuation">(</span>levelManager<span class="token punctuation">.</span>basicSlimeColor<span class="token punctuation">,</span>
                                <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">bool</span></span><span class="token punctuation">[</span>levelManager<span class="token punctuation">.</span>dyeAmount<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">Save</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// Save a level data inside the computer</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token comment">/// &lt;param name="data"&gt;The level data to save.&lt;/param&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Save</span><span class="token punctuation">(</span><span class="token class-name">LevelData</span> data<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name">BinaryFormatter</span> formatter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BinaryFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name"><span class="token keyword">string</span></span> path <span class="token operator">=</span> Application<span class="token punctuation">.</span>persistentDataPath <span class="token operator">+</span> <span class="token string">"/level.tmw"</span><span class="token punctuation">;</span>
  <span class="token comment">// Open the file to start saving the data</span>
  <span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">)</span><span class="token punctuation">;</span>

  formatter<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  stream<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// Load the progress saved inside the computer, if it doesn't exist make a new save.</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token comment">/// &lt;param name="levelManager"&gt;The level manager to use in case there is no data.&lt;/param&gt;</span>
<span class="token comment">/// &lt;returns&gt;The level data saved&lt;/returns&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">LevelData</span> <span class="token function">LoadProgress</span><span class="token punctuation">(</span><span class="token class-name">LevelManager</span> levelManager<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name"><span class="token keyword">string</span></span> path <span class="token operator">=</span> Application<span class="token punctuation">.</span>persistentDataPath <span class="token operator">+</span> <span class="token string">"/level.tmw"</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name">BinaryFormatter</span> formatter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BinaryFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Open the file to start saving the data</span>
    <span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get the info and make it a usable level data</span>
    <span class="token class-name">LevelData</span> data <span class="token operator">=</span> formatter<span class="token punctuation">.</span><span class="token function">Deserialize</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token class-name">LevelData</span><span class="token punctuation">;</span>
    stream<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// Nothing found, we create a new save</span>
  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LevelData</span><span class="token punctuation">(</span>levelManager<span class="token punctuation">.</span>basicSlimeColor<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">bool</span></span><span class="token punctuation">[</span>levelManager<span class="token punctuation">.</span>dyeAmount<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">System<span class="token punctuation">.</span>Serializable</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LevelData</span>
<span class="token punctuation">{</span>
  <span class="token class-name"><span class="token keyword">int</span></span> _level<span class="token punctuation">;</span> <span class="token comment">// The level the player left the game</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> level <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _level<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token class-name"><span class="token keyword">int</span></span> _floor<span class="token punctuation">;</span> <span class="token comment">// The floor the player left the game</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> floor <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _floor<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token class-name"><span class="token keyword">int</span></span> _highestFloor<span class="token punctuation">;</span> <span class="token comment">// The highest floor the player achieved</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> highestFloor <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _highestFloor<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token class-name"><span class="token keyword">bool</span></span> _nextFloorUnlocked<span class="token punctuation">;</span> <span class="token comment">// Did the animation for the next floor have been played</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> nextFloorUnlocked <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _nextFloorUnlocked<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token comment">// At which level the player have seen animation so we don't play it twice</span>
  <span class="token class-name"><span class="token keyword">int</span></span> _levelAnimationPlayed<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> levelAnimationPlayed <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _levelAnimationPlayed<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token comment">// Which dye have been collected</span>
  <span class="token class-name"><span class="token keyword">bool</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> _dyeCollected<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> dyeCollected <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _dyeCollected<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token comment">// Saving the dye RGB of the current color the player is wearing</span>
  <span class="token class-name"><span class="token keyword">float</span></span> _dyeRed<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> dyeRed <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _dyeRed<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token class-name"><span class="token keyword">float</span></span> _dyeGreen<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> dyeGreen <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _dyeGreen<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token class-name"><span class="token keyword">float</span></span> _dyeBlue<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> dyeBlue <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _dyeBlue<span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">LevelData</span><span class="token punctuation">(</span><span class="token class-name">Color</span> dyeColor<span class="token punctuation">,</span> 
                  <span class="token class-name"><span class="token keyword">bool</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> dyeCollected<span class="token punctuation">,</span>
                  <span class="token class-name"><span class="token keyword">int</span></span> level <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> 
                  <span class="token class-name"><span class="token keyword">int</span></span> floor <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> 
                  <span class="token class-name"><span class="token keyword">int</span></span> highestFloor <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> 
                  <span class="token class-name"><span class="token keyword">bool</span></span> nextFloorUnlocked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> 
                  <span class="token class-name"><span class="token keyword">int</span></span> levelAnimationPlayed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _level <span class="token operator">=</span> level<span class="token punctuation">;</span>
    _floor <span class="token operator">=</span> floor<span class="token punctuation">;</span>
    _highestFloor <span class="token operator">=</span> highestFloor<span class="token punctuation">;</span>
    _nextFloorUnlocked <span class="token operator">=</span> nextFloorUnlocked<span class="token punctuation">;</span>
    _levelAnimationPlayed <span class="token operator">=</span> levelAnimationPlayed<span class="token punctuation">;</span>
    _dyeRed <span class="token operator">=</span> dyeColor<span class="token punctuation">.</span>r<span class="token punctuation">;</span>
    _dyeGreen <span class="token operator">=</span> dyeColor<span class="token punctuation">.</span>g<span class="token punctuation">;</span>
    _dyeBlue <span class="token operator">=</span> dyeColor<span class="token punctuation">.</span>b<span class="token punctuation">;</span>
    _dyeCollected <span class="token operator">=</span> dyeCollected<span class="token punctuation">;</span>
    <span class="token comment">// Make sure the player always have the basic color unlocked</span>
    _dyeCollected<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code>
</pre>

<h4>Level mask</h4>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Masking.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<h3 id="Polish-TheMeltyWay">Polish</h3>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Polish.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<ul>
  <li>Particle effects</li>
  <li>Programmatic animation</li>
  <li>Visual feedback</li>
  <li>NPC animations for cutscenes</li>
  <li>Scene transitions</li>
  <li>Bug fixing</li>
  <li>End of level and epic achievement animations</li>
  <li>Builds for all platforms</li>
  <li>Splatters on walls and objects</li>
  <li>Steam achievements</li>
  <li>Title screen animation</li>
  <li>Decorative interactable elements</li>
  <li>Large level selector</li>
  <li>Different colors for the slime</li>
  <li>Flashing indicators for timers and sound cues</li>
  <li>Settings with all essential options</li>
  <li>Sound effects</li>
  <li>Random pitch and fade-in/fade-out for sounds</li>
  <li>Music that changes based on levels and blends seamlessly</li>
  <li>Custom cursor</li>
</ul>

<h4>Settings</h4>

<div class="image-video-container">
  <img src="Images/Contents/TheMeltyWay/Settings.jpg" loading="lazy">
</div>

<h4>Transition</h4>

<div class="image-video-container">
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Portal-transition.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <video width="500" loop="" muted="" playsinline="" preload="none" data-src="Images/Contents/TheMeltyWay/Death-transition.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<h4>Dye</h4>

<div class="image-video-container">
  <img src="Images/Contents/TheMeltyWay/Dye.jpg" loading="lazy">
</div>

<h4>Level selection</h4>

<div class="image-video-container">
  <img src="Images/Contents/TheMeltyWay/Level-selection.jpg" loading="lazy">
</div></div></div></div></div><div class="game"><div class="game-thumbnail"><div class="game-technologies"><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Unity.png');"></div></div></div><div class="thumbnail-content"><i>Janurary 2021 ~ March 2021</i><h2>Citywars Savage</h2><p>An indie MMORPG combining fast-paced combat, sandbox building, questing and cooperative PvE. With classless progression, gear upgrades and community-driven content creation.</p></div><div class="image-thumbnail" style="background-image: url('Images/Thumbnails/CitywarsSavage main.jpg');"></div><div class="image-thumbnail-over" style="background-image: url('Images/Thumbnails/CitywarsSavage gameplay.jpg');"></div></div><div class="game-content"><div class="game-container"><div class="game-content-header"><div class="game-content-header-title"><div class="game-content-header-logo"><img src="Images/Logos/CitywarsSavage.png"></div><div class="game-content-header-links"><a target="_blank" class="game-link" href="https://store.steampowered.com/app/910800/Citywars_Savage/" style="background-image: url('Images/Stores/Steam.png');"></a></div></div><div class="game-content-header-tag"><div class="game-genre">MMORPG</div><div class="game-genre">Sandbox</div><div class="game-genre">Crafting</div><div class="game-genre">Building</div><div class="game-style">Cartoon</div><div class="game-style">Cubic</div></div><div class="game-content-header-job"><div class="game-content-header-role"><img class="job-icon" src="Images/Icons/role.svg">Gameplay Programmer, Game Design</div><div class="game-content-header-team"><img class="job-icon" src="Images/Icons/team.svg">8</div><div class="game-content-header-time"><img class="job-icon" src="Images/Icons/time.svg">3 months</div></div></div><div class="game-content-main" id="CitywarsSavageContent"><h3>Advanced boss design and behavior trees</h3>
<p>
  In this project, I focused on creating dynamic, content-driven boss encounters using a custom
  blueprint system. My goal was to implement complex AI behaviors and phase-based
  mechanics to challenge players while maintaining engaging and interactive combat.
  The game was developed as a multiplayer experience, allowing multiple players to cooperate during intense boss fights
  and dynamically adapt to evolving challenges together.
</p>

<p>
  The first boss was a lava rock monster with three distinct attacks:
  meteor strikes from the sky, fire projectiles and summoned minions.
  Its behavior was governed by a behavior tree system and its attack strength dynamically
  scaled according to its health-based phases. Additionally, this boss had terrain-destructive abilities.
  As the fight progressed, the environment became increasingly damaged, creating new hazards such as
  underground lava that required the players to continuously adapt their strategy and coordinate positioning to survive.
</p>

<p>
  The second boss, a Treant, specialized in environmental control.
  It spawned vines to defend itself, could summon a row of damaging vines toward the players,
  and create a circular zone of vine attacks beneath player positions.
  Furthermore, it could generate smaller treants from uncut trees, introducing layered threats and forcing the team to
  manage multiple priorities simultaneously, balancing crowd control, area awareness and target focus.
</p>

<p>
  The third boss, a spider entity, focused on mobility and area denial.
  It spawned smaller spiders, shot cobwebs to restrict player movement and constantly maintained distance from players
  to enforce strategic positioning.
  If players got too close, it began using powerful bite attacks. Because ranged combat was the most effective strategy,
  the spider AI was designed to intelligently kite players, keeping them at bay while maintaining offensive pressure.
  Designing this boss required careful calibration of AI decision-making to ensure it intelligently prioritized
  positioning, spawning and attack timing even in multiplayer scenarios.
</p>

<p>
  Overall, this project enhanced my understanding of behavior tree architecture,
  phase-based AI scaling, procedural environmental interaction and how to design layered, reactive encounters.
  It also emphasized the importance of balancing challenge, telegraphing mechanics and creating emergent gameplay
  scenarios within cooperative multiplayer boss fights, where teamwork and strategy were critical to success.
</p>

<p>
  In this project, I also implemented a pirate boat environment populated by goblin NPCs with complex, task-driven
  behaviors.
  Each goblin had a set of responsibilities that contributed to a living and interactive world.
</p>
<p>
  Their tasks included loading cannonballs into cannons, firing at beach guards
  and performing daily routines such as eating and sleeping. These behaviors were managed by a
  task scheduling system, which allowed the AI to prioritize actions, respond to environmental triggers
  and switch between combat, maintenance and rest activities dynamically.
</p>
<p>
  Overall, this project enhanced my understanding of dynamic AI systems, task prioritization
  and environment-driven behaviors, enabling me to create more immersive and interactive gameplay scenarios.
</p></div></div></div></div><div class="game-content-space" style="position: absolute; height: 0px;"></div><div class="game"><div class="game-thumbnail"><div class="game-technologies"><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Unity.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/CSharp.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Github.png');"></div></div></div><div class="thumbnail-content"><i>Feburary 2024 ~ April 2024</i><h2>Dream Catcher</h2><p>In this whimsical multiplayer platformer, a tiny snail journeying through surreal dreamscapes. As a team of two, it is needed to collect scattered dreams and keep the dreamer peacefully asleep.</p></div><div class="image-thumbnail" style="background-image: url('Images/Thumbnails/DreamCatcher main.jpg');"></div><div class="image-thumbnail-over" style="background-image: url('Images/Thumbnails/DreamCatcher gameplay.jpg');"></div></div><div class="game-content"><div class="game-container"><div class="game-content-header"><div class="game-content-header-title"><div class="game-content-header-logo"><img src="Images/Logos/DreamCatcher.png"></div></div><div class="game-content-header-tag"><div class="game-genre">Plateformer</div><div class="game-genre">Coop</div><div class="game-style">Vector art</div><div class="game-style">Fantasy</div></div><div class="game-content-header-job"><div class="game-content-header-role"><img class="job-icon" src="Images/Icons/role.svg">Gameplay Programmer</div><div class="game-content-header-team"><img class="job-icon" src="Images/Icons/team.svg">8</div><div class="game-content-header-time"><img class="job-icon" src="Images/Icons/time.svg">3 months</div></div></div><div class="game-content-main" id="DreamCatcherContent"><h3>Peer-to-Peer Multiplayer Networking</h3>
<p>
  This project represented my first experience developing a multiplayer game,
  where I was primarily responsible for implementing and optimizing the networked gameplay systems.
  I built a peer-to-peer connection model that allowed players on the same local
  network to seamlessly connect and interact in real time.
</p>
<p>
  Developing this functionality required an in-depth understanding of network architecture,
  including distinctions between client-side and server-side operations.
  Early in development, I encountered synchronization and authority issues that occurred because
  certain actions were not properly replicated on the client side. Through iterative testing, I learned
  how to manage data flow securely between hosts and clients, handle latency compensation,
  and address potential security vulnerabilities inherent to P2P systems.
</p>
<p>
  The project also reinforced the importance of team collaboration.
  Because team availability varied significantly, we relied heavily on well-documented code,
  inline comments and consistent naming conventions to maintain
  project clarity and ensure that each developer could contribute effectively despite asynchronous work schedules.
</p>
<p>
  Ultimately, this experience strengthened my understanding of multiplayer system design,
  network synchronization and the critical role of clean, maintainable code
  in distributed development environments.
</p></div></div></div></div><div class="game"><div class="game-thumbnail"><div class="game-technologies"><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Unity.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/CSharp.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Adobe.png');"></div></div></div><div class="thumbnail-content"><i>Feburary 2023</i><h2>Sightline</h2><p>A cunning outlaw in the Wild West, planning heists, dodging sheriffs and looting banks for fortune and freedom.</p></div><div class="image-thumbnail" style="background-image: url('Images/Thumbnails/Sightline main.jpg');"></div><div class="image-thumbnail-over" style="background-image: url('Images/Thumbnails/Sightline gameplay.jpg');"></div></div><div class="game-content"><div class="game-container"><div class="game-content-header"><div class="game-content-header-title"><div class="game-content-header-logo"><img src="Images/Logos/Sightline.png"></div><div class="game-content-header-links"><a target="_blank" class="game-link" href="https://toominio.itch.io/sightline" style="background-image: url('Images/Stores/Itch.io.png');"></a></div></div><div class="game-content-header-tag"><div class="game-genre">Stealth</div><div class="game-genre">Extraction</div><div class="game-genre">Time manipulation</div><div class="game-style">Far west</div><div class="game-style">Vector art</div></div><div class="game-content-header-job"><div class="game-content-header-role"><img class="job-icon" src="Images/Icons/role.svg">Game Programmer, Artist, Game Design</div><div class="game-content-header-team"><img class="job-icon" src="Images/Icons/team.svg">3</div><div class="game-content-header-time"><img class="job-icon" src="Images/Icons/time.svg">3 days</div></div></div><div class="game-content-main" id="SightlineContent"><h3>First game jam experience</h3>
<p>
  This project marked my first-ever participation in a Game Jam.
  Our team initially consisted of four members, but one member became inactive once the event began,
  leaving us as a team of three developers. Despite the limited team size and the absence of an artist,
  we successfully completed a playable and engaging prototype within the strict time constraints of the competition.
</p>
<p>
  The development process was both challenging and rewarding.
  We focused on creating a competitive experience that included a functional
  leaderboard system linked to an online server.
  This required me to learn about network communication, API integration and
  HTTP requests to manage player scores and synchronize data between clients and the remote database.
</p>
<p>
  There was a mechanic to slow down time, but it was also unintentionally slowing down the speedrun timer.
  We wanted the time-slowing ability to give the player an advantage while still introducing a drawback,
  since they would move slower too, but not to affect the speedrun timer. To fix this, I switched to using
  real time instead of the in-game time since the start and it worked much better.
</p>
<p>
  Time management was a crucial skill I developed during this project.
  Working under the intense time pressure of a game jam environment taught me how to prioritize features,
  identify minimum viable functionality and use asset packages and
  plug-ins strategically to accelerate production without sacrificing quality.
  This experience helped me understand the importance of efficient workflow pipelines and rapid iteration in game
  development.
</p>
<p>
  Overall, this game jam reinforced key lessons in collaboration, adaptability and agile development practices.
  As well as the ability to transform creative ideas into a functional prototype within a highly compressed timeframe.
</p></div></div></div></div><div class="game"><div class="game-thumbnail"><div class="game-technologies"><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Unity.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/CSharp.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Github.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Adobe.png');"></div></div></div><div class="thumbnail-content"><i>March 2021 ~ April 2021</i><h2>Zero Six Booting</h2><p>A swift ninja armed with a deadly spear use a grappling hook, slow down time and rewind time in this intense, action-adventure plateformer.</p></div><div class="image-thumbnail" style="background-image: url('Images/Thumbnails/ZeroSixBooting main.jpg');"></div><div class="image-thumbnail-over" style="background-image: url('Images/Thumbnails/ZeroSixBooting gameplay.jpg');"></div></div><div class="game-content"><div class="game-container"><div class="game-content-header"><div class="game-content-header-title"><div class="game-content-header-logo"><img src="Images/Logos/ZeroSixBooting.png"></div><div class="game-content-header-links"><a target="_blank" class="game-link" href="https://betteromra.itch.io/zero-six-booting" style="background-image: url('Images/Stores/Itch.io.png');"></a></div></div><div class="game-content-header-tag"><div class="game-genre">Hack 'n' Slash</div><div class="game-genre">Time manipulation</div><div class="game-genre">Plateformer</div><div class="game-style">Pixel Art</div><div class="game-style">Science fiction</div></div><div class="game-content-header-job"><div class="game-content-header-role"><img class="job-icon" src="Images/Icons/role.svg">Game Programmer, Artist, Game Design</div><div class="game-content-header-team"><img class="job-icon" src="Images/Icons/team.svg">1</div><div class="game-content-header-time"><img class="job-icon" src="Images/Icons/time.svg">2 months</div></div></div><div class="game-content-main" id="ZeroSixBootingContent"><h3>Physics-based movement and rewind system</h3>
<p>
  This project was heavily inspired by
  <a href="https://store.steampowered.com/app/460950/Katana_ZERO/" target="_blank">Katana ZERO</a>
  and focused on creating fast-paced,
  physics-driven gameplay. The most technically challenging part of development involved implementing
  smooth character and enemy movement across sloped surfaces while maintaining a
  consistent velocity regardless of terrain inclination.
</p>
<p>
  To achieve this, I had to refine the movement physics by adjusting
  Rigidbody2D forces and custom velocity calculations, ensuring both the player and enemies
  preserved uniform motion across varying slope gradients. This required careful handling of
  raycasts and normal vectors to maintain grounded movement and prevent speed fluctuations.
</p>
<p>
  One of the core mechanics I implemented was a rewind system,
  which involved capturing and storing the player's positional data over time.
  The system continuously recorded the player's transform.position at each frame,
  and when triggered, it iterated backward through the stored data to restore the player's
  previous states with precise temporal accuracy. This mechanic introduced challenges in
  data management and interpolation, especially when handling physics-based interactions.
</p>
<p>
  Additionally, I designed a grappling hook mechanic using Unity's
  SpringJoint2D component combined with a LineRenderer for visual feedback.
  The grappling system allowed the player to attach to walls dynamically, generating tension and
  swing physics that enhanced both traversal and combat fluidity.
</p>
<p>
  Overall, this project deepened my understanding of 2D physics simulation,
  data-driven rewind mechanics and procedural animation techniques,
  all of which contributed to a more polished and technically complex gameplay experience.
</p></div></div></div></div><div class="game"><div class="game-thumbnail"><div class="game-technologies"><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Unity.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/CSharp.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Adobe.png');"></div></div></div><div class="thumbnail-content"><i>December 2020 ~ January 2021</i><h2>The Orc Cook</h2><p>An orc chef combines ingredients in precise sequences to create hearty meals. Each successful combination, boosts reputation and satisfies the tribe's hunger in a puzzle of timing and culinary mastery.</p></div><div class="image-thumbnail" style="background-image: url('Images/Thumbnails/TheOrcCook main.jpg');"></div><div class="image-thumbnail-over" style="background-image: url('Images/Thumbnails/TheOrcCook gameplay.jpg');"></div></div><div class="game-content"><div class="game-container"><div class="game-content-header"><div class="game-content-header-title"><div class="game-content-header-logo"><img src="Images/Logos/TheOrcCook.png"></div><div class="game-content-header-links"><a target="_blank" class="game-link" href="https://betteromra.itch.io/the-orc-cook" style="background-image: url('Images/Stores/Itch.io.png');"></a></div></div><div class="game-content-header-tag"><div class="game-genre">Match-3</div><div class="game-genre">Puzzle</div><div class="game-style">Vector art</div><div class="game-style">Fantasy</div></div><div class="game-content-header-job"><div class="game-content-header-role"><img class="job-icon" src="Images/Icons/role.svg">Game Programmer, Artist, Game Design</div><div class="game-content-header-team"><img class="job-icon" src="Images/Icons/team.svg">1</div><div class="game-content-header-time"><img class="job-icon" src="Images/Icons/time.svg">2 months</div></div></div><div class="game-content-main" id="TheOrcCookContent"><h3>Data-driven design and dynamic difficulty</h3>
<p>
  This was my first personal project and it focused heavily on creating a
  data-driven architecture using scriptable objects in Unity.
  The main goal of the project was to design a flexible system that could dynamically generate
  levels by selecting recipes from a data bank while maintaining a balanced
  and engaging level of difficulty.
</p>
<p>
  I implemented an algorithm to select recipes procedurally based on predefined difficulty curves.
  The system ensured that each level generated contained challenges that were neither too simple nor overly complex.
  To achieve this, I introduced a graduated difficulty mechanic, increasing the complexity of
  recipes while compensating with speed bonuses to preserve pacing and prevent player fatigue.
</p>
<p>
  Once a recipe was chosen, the system automatically retrieved all the required ingredients and ensured that
  at least one of each was available in the generated level. After populating the mandatory elements,
  I developed a secondary logic layer to fill the remaining slots with randomized ingredients
  to keep gameplay fresh and unpredictable while preserving the overall balance of the experience.
</p>
<p>
  Through this project, I deepened my understanding of procedural generation,
  data encapsulation and system scalability, all essential skills for building robust and adaptable game mechanics.
</p></div></div></div></div><div class="game"><div class="game-thumbnail"><div class="game-technologies"><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Unity.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/CSharp.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Github.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Adobe.png');"></div></div></div><div class="thumbnail-content"><i>September 2020 ~ December 2020</i><h2>Plateformer Squelletron</h2><p>A skeleton traverses an endlessly generated world, jumping across platforms, avoiding dangers and exploring haunting, ever-changing landscapes full of surprises.</p></div><div class="image-thumbnail" style="background-image: url('Images/Thumbnails/PlateformerSquelletron main.jpg');"></div><div class="image-thumbnail-over" style="background-image: url('Images/Thumbnails/PlateformerSquelletron gameplay.jpg');"></div></div><div class="game-content"><div class="game-container"><div class="game-content-header"><div class="game-content-header-title"><h2 class="game-content-header-no-logo">Plateformer Squelletron</h2></div><div class="game-content-header-tag"><div class="game-genre">Plateformer</div><div class="game-genre">Procedural generation</div><div class="game-style">Dark Fantasy</div><div class="game-style">Vector art</div></div><div class="game-content-header-job"><div class="game-content-header-role"><img class="job-icon" src="Images/Icons/role.svg">Game Programmer, Artist, Game Design</div><div class="game-content-header-team"><img class="job-icon" src="Images/Icons/team.svg">2</div><div class="game-content-header-time"><img class="job-icon" src="Images/Icons/time.svg">3 months</div></div></div><div class="game-content-main" id="PlateformerSquelletronContent"><h3>Procedural generation and 2D lighting</h3>
<p>
  This project centered around creating a procedurally generated maze that the main character could navigate.
  The development process was guided by our instructor, but by the final phase, we were encouraged to integrate our own
  unique gameplay mechanics and technical features.
</p>
<p>
  Through this project, I explored the core principles that make a platformer both engaging and dynamic,
  responsive controls, clear feedback loops and level design that encourages exploration and flow.
  I gained practical experience in implementing procedural content generation algorithms to create
  infinitely expanding levels, learning firsthand about the structural challenges of generating
  coherent environments that maintain both playability and performance stability.
</p>
<p>
  The project was developed collaboratively between two team members. While sharing tasks proved difficult, largely due
  to
  my enthusiasm and desire to handle multiple aspects of the development process, it reinforced the importance of
  workload distribution, communication and collaborative version control
  in team-based environments.
</p>
<p>
  Additionally, I experimented with Unity's 2D lighting system, implementing real-time lighting
  to enhance visual depth and atmosphere. This led me to confront performance optimization challenges,
  particularly when managing a high number of active light sources and taught me how to balance graphical fidelity with
  runtime efficiency.
</p></div></div></div></div><div class="game"><div class="game-thumbnail"><div class="game-technologies"><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Unity.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/CSharp.png');"></div></div></div><div class="thumbnail-content"><i>September 2020 ~ October 2020</i><h2>Sorcière avec éclair de feu versus Chevaliers avec nimbus 2001 sauf que les balais sont interdit</h2><p>A strategic, turn-based adventure where you, a witch, navigate enemies, plan moves carefully and reach the finish line triumphantly.</p></div><div class="image-thumbnail" style="background-image: url('Images/Thumbnails/SorcireavecclairdefeuversusChevaliersavecnimbus2001saufquelesbalaissontinterdit main.jpg');"></div><div class="image-thumbnail-over" style="background-image: url('Images/Thumbnails/SorcireavecclairdefeuversusChevaliersavecnimbus2001saufquelesbalaissontinterdit gameplay.jpg');"></div></div><div class="game-content"><div class="game-container"><div class="game-content-header"><div class="game-content-header-title"><h2 class="game-content-header-no-logo">Sorcière avec éclair de feu versus Chevaliers avec nimbus 2001 sauf que les balais sont interdit</h2></div><div class="game-content-header-tag"><div class="game-genre">Turn-Based</div><div class="game-genre">Stealth</div><div class="game-style">Fantasy</div></div><div class="game-content-header-job"><div class="game-content-header-role"><img class="job-icon" src="Images/Icons/role.svg">Game Programmer, Game Design</div><div class="game-content-header-team"><img class="job-icon" src="Images/Icons/team.svg">1</div><div class="game-content-header-time"><img class="job-icon" src="Images/Icons/time.svg">2 months</div></div></div><div class="game-content-main" id="SorcireavecclairdefeuversusChevaliersavecnimbus2001saufquelesbalaissontinterditContent"><h3>Turn-based mechanics and AI fundamentals</h3>
<p>
  This was a relatively small-scale project, but it introduced several key challenges that deepened my understanding of
  game logic and artificial intelligence systems. The most technically demanding aspect was implementing the
  turn-based gameplay architecture, which required precise state management, player input handling and
  synchronization between player and AI turns.
</p>
<p>
  Developing simple AI behaviors presented an engaging challenge.
  I designed multiple enemy archetypes with distinct logic patterns. One enemy utilized a line-of-sight detection system
  that triggered the enemy to walk to the player position and capture him if it was his turn.
  Another followed a predefined patrol route using waypoint navigation;
  and a third exhibited randomized movement.
</p></div></div></div></div><div class="game"><div class="game-thumbnail"><div class="game-technologies"><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Unity.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/CSharp.png');"></div></div></div><div class="thumbnail-content"><i>October 2020 ~ December 2020</i><h2>Attaque des patates</h2><p>A humble village boy sets out on a thrilling RPG adventure, exploring vast lands, making loyal friends, engaging in strategic turn-based battles and confronting a powerful necromancer to save the world.</p></div><div class="image-thumbnail" style="background-image: url('Images/Thumbnails/Attaquedespatates main.jpg');"></div><div class="image-thumbnail-over" style="background-image: url('Images/Thumbnails/Attaquedespatates gameplay.jpg');"></div></div><div class="game-content"><div class="game-container"><div class="game-content-header"><div class="game-content-header-title"><h2 class="game-content-header-no-logo">Attaque des patates</h2></div><div class="game-content-header-tag"><div class="game-genre">RPG</div><div class="game-genre">Turn-Based</div><div class="game-style">Dark Fantasy</div><div class="game-style">Vector art</div></div><div class="game-content-header-job"><div class="game-content-header-role"><img class="job-icon" src="Images/Icons/role.svg">Game Programmer</div><div class="game-content-header-team"><img class="job-icon" src="Images/Icons/team.svg">4</div><div class="game-content-header-time"><img class="job-icon" src="Images/Icons/time.svg">3 months</div></div></div><div class="game-content-main" id="AttaquedespatatesContent"><h3>Collaborative game development experience</h3>
<p>
  This project represented a significant leap in complexity and ambition compared to my earlier individual endeavors.
  Our development team consisted of two artists and two programmers, each contributing to different aspects of the
  production pipeline.
  The project's core functionality had already been implemented, so our task as programmers was to extend the feature
  set,
  refactor unstable code segments and resolve numerous technical issues inherited from prior iterations.
</p>
<p>
  Among the major additions we implemented were unique monster abilities,
  enhanced interactive storytelling elements and a final boss encounter
  featuring advanced state management and AI-driven attack patterns. These additions required close collaboration
  between
  the programming and art teams to synchronize gameplay logic with animation states, visual effects and sound cues.
</p>
<p>
  This project became a pivotal experience in understanding the dynamics of team-based software development.
  I learned how to efficiently distribute tasks using agile-inspired workflows, manage version control using Git and
  GitHub branches to minimize merge conflicts and conduct regular code reviews to ensure architectural consistency.
</p>
<p>
  Furthermore, I gained valuable experience in reading and interpreting existing codebases, learning to understand
  another developer's logic, design patterns and architectural choices. This process improved my debugging skills,
  deepened my understanding of collaborative programming practices and reinforced the importance of clean,
  well-documented and modular code when working in a shared environment.
</p></div></div></div></div><div class="game"><div class="game-thumbnail"><div class="game-technologies"><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Unity.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/CSharp.png');"></div></div></div><div class="thumbnail-content"><i>November 2020 ~ December 2020</i><h2>Mille Etage</h2><p>Build and manage your hotel empire, upgrade floors, attract guests, optimize profits, automate operations and watch income grow effortlessly.</p></div><div class="image-thumbnail" style="background-image: url('Images/Thumbnails/MilleEtage main.jpg');"></div><div class="image-thumbnail-over" style="background-image: url('Images/Thumbnails/MilleEtage gameplay.jpg');"></div></div><div class="game-content"><div class="game-container"><div class="game-content-header"><div class="game-content-header-title"><h2 class="game-content-header-no-logo">Mille Etage</h2></div><div class="game-content-header-tag"><div class="game-genre">Idle</div></div><div class="game-content-header-job"><div class="game-content-header-role"><img class="job-icon" src="Images/Icons/role.svg">Game Programmer</div><div class="game-content-header-team"><img class="job-icon" src="Images/Icons/team.svg">1</div><div class="game-content-header-time"><img class="job-icon" src="Images/Icons/time.svg">2 months</div></div></div><div class="game-content-main" id="MilleEtageContent"><h3>Deepening my programming knowledge</h3>
<p>
  This project significantly expanded my understanding of programming principles beyond the surface level.
  I began to integrate more advanced paradigms of Object-Oriented Programming,
  applying concepts such as Polymorphism, Encapsulation,
  Data Abstraction and Inheritance to create cleaner and more modular code structures.
</p>
<p>
  Through hands-on experimentation, I learned how to utilize coroutines correctly for asynchronous operations,
  managing time-dependent behaviors such as cooldowns, animations and event-driven logic. I also implemented custom
  event systems to decouple
  gameplay logic, improving scalability and maintainability across different game components.
</p>
<p>
  My primary focus throughout this project was not on crafting a polished gameplay experience,
  but rather on optimizing performance, ensuring system stability and designing an architecture that could
  scale efficiently for future features. This approach helped me internalize core software engineering concepts
  like code reusability, modularity and efficient memory management within a game engine context.
</p></div></div></div></div><div class="game"><div class="game-thumbnail"><div class="game-technologies"><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Unity.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/CSharp.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Adobe.png');"></div></div></div><div class="thumbnail-content"><i>November 2019 ~ December 2019</i><h2>Hinvie Zible</h2><p>Small prototype that lets you be a ghost in a graveyard and use different ability.</p></div><div class="image-thumbnail" style="background-image: url('Images/Thumbnails/HinvieZible main.jpg');"></div><div class="image-thumbnail-over" style="background-image: url('Images/Thumbnails/HinvieZible gameplay.jpg');"></div></div><div class="game-content"><div class="game-container"><div class="game-content-header"><div class="game-content-header-title"><h2 class="game-content-header-no-logo">Hinvie Zible</h2></div><div class="game-content-header-job"><div class="game-content-header-role"><img class="job-icon" src="Images/Icons/role.svg">Game Programmer, Game Design</div><div class="game-content-header-team"><img class="job-icon" src="Images/Icons/team.svg">1</div><div class="game-content-header-time"><img class="job-icon" src="Images/Icons/time.svg">2 months</div></div></div><div class="game-content-main" id="HinvieZibleContent"><h3>Ambition and scope management</h3>
<p>
  At that stage of my journey, I was extremely ambitious and invested a significant amount of time experimenting with UI
  mechanics.
  I spent nearly three full days developing a carousel-style animated main menu interface, implementing rotation logic
  and smooth transitions
  using Lerp() functions for seamless element movement. I was starting to create my own script and understanding how C#
  worked.
</p>
<p>
  Once the user interface was functional, I shifted focus to the main player character. My goal was to replicate the
  fluid and responsive combat
  mechanics of <a href="https://www.leagueoflegends.com/en-sg/champions/riven/" target="_blank">Riven</a>
  from League of Legends. This led me to design and prototype the Q ability, this was a very hard task at that time, I
  managed
  to make it work after barely understanding coroutine and the UI System that show the radial cooldown on the ability.
</p>
<p>
  My narrow focus on this subsystem caused me to neglect other critical components, the visual assets, basic core
  gameplay and overall content.
  As a result, the project became visually unpolished and uninteresting.
</p>
<p>
  Through this experience, I learned an invaluable lesson about project scope management and resource allocation
  in solo development. I realized the importance of adopting an incremental development approach, creating smaller,
  achievable milestones
  and maintaining a balance between ambition and feasibility when working independently on large-scale projects.
</p></div></div></div></div><div class="game"><div class="game-thumbnail"><div class="game-technologies"><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/Unity.png');"></div></div><div class="game-technology"><div class="game-technology-image" style="background-image: url('Images/Technologies/CSharp.png');"></div></div></div><div class="thumbnail-content"><i>March 2017 ~ April 2017</i><h2>Tower Defense</h2><p>My first game ever, a tower defense where you strategically place towers, stop enemies, survive waves, defend your base.</p></div><div class="image-thumbnail" style="background-image: url('Images/Thumbnails/TowerDefense main.jpg');"></div><div class="image-thumbnail-over" style="background-image: url('Images/Thumbnails/TowerDefense gameplay.jpg');"></div></div><div class="game-content"><div class="game-container"><div class="game-content-header"><div class="game-content-header-title"><h2 class="game-content-header-no-logo">Tower Defense</h2></div><div class="game-content-header-tag"><div class="game-genre">Tower defense</div></div><div class="game-content-header-job"><div class="game-content-header-role"><img class="job-icon" src="Images/Icons/role.svg">Game Programmer</div><div class="game-content-header-team"><img class="job-icon" src="Images/Icons/team.svg">1</div><div class="game-content-header-time"><img class="job-icon" src="Images/Icons/time.svg">2 weeks</div></div></div><div class="game-content-main" id="TowerDefenseContent"><h3>Early game development journey</h3>
<p>
  During that period, I was deeply fascinated by the idea of developing game on a computer.
  Initially, I experimented with creating simple games on my graphing calculator, utilizing basic scripting logic and
  procedural programming concepts. However, I was unable to transition those small-scale projects into more complex
  software builds.
</p>
<p>
  My first real exposure to professional game development came through
  <a href="https://m.youtube.com/watch?v=beuoNuK2tbk" target="_blank">Brackeys' Unity tutorial : How to make a Tower
    Defense Game</a>.
  At the beginning, I had minimal understanding of how the Unity Engine worked, concepts such as
  GameObjects, Components, Transform and Vectors were completely new to me.
  I meticulously followed the tutorial line by line, replicating each C# script and inspecting how the
  game loop functioned under the hood.
</p>
<p>
  Through this process, I gained a much better understanding of fundamental principles such as
  object-oriented programming, FixedUpdate()/Update() and Awake()/Start() methods in the Unity scripting lifecycle
  and how to attach custom scripts to GameObjects via the component-based architecture.
  I also learned to manipulate movement to make the ennemy follow a path, implement collision detection,
  and utilize the Inspector for parameter tuning and debugging.
</p>
<p>
  This hands-on experience served as a crucial foundation for my future in software engineering and game development.
  It enhanced my computational thinking, introduced me to the concept of a real-time rendering pipeline and
  helped me bridge the gap between simple linear programming and practical implementation within an IDE within a much
  more complexe program.
</p></div></div></div></div></div>
  </div>

  <script src="script.min.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-c.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-cpp.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-csharp.min.js"></script>
</body>

</html>